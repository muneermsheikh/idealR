"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[729],{8729:(D,v,o)=>{o.r(v),o.d(v,{CallRecordModule:()=>K});var c=o(6814),Z=o(3983),C=o(8180),T=o(2181),U=o(4664),R=o(6306),m=o(2096),A=o(9397),w=o(369);class u{constructor(){this.id=0,this.personType="",this.incomingOutgoing="",this.dateOfContact=new Date,this.personId="",this.mobileNo="",this.emailId="",this.categoryRef="",this.status="",this.statusClass="Active",this.username="",this.gistOfDiscussions="",this.advisoryBy="",this.nextAction="",this.nextActionOn=new Date,this.subject="",this.search="",this.sort="",this.pageNumber=1,this.pageSize=15}}var t=o(5879),O=o(7328),b=o(7398),P=o(5516),p=o(1436),M=o(9862),g=o(8763);let N=(()=>{class i{constructor(e,s){this.http=e,this.toastr=s,this.apiUrl=P.N.apiUrl,this.currentUserSource=new O.t(1),this.currentUser$=this.currentUserSource.asObservable(),this.histParams=new u,this.categoryRefDtos=[],this.cache=new Map,this.contactResults=[{status:"Not Reachable"},{status:"Wrong Number"},{status:"Declined-Family Issues"},{status:"Declined-Low Remuneration"},{status:"Declined-Other Reasons"},{status:"Will Call later"},{status:"Not interested for overseas"},{status:"Declined-Service Charges"}]}getContactResults(){return this.contactResults}setParams(e){this.histParams=e}getParams(){return this.histParams}getCategoryRefDetails(){return this.http.get(this.apiUrl+"categoryrefdetails").pipe((0,b.U)(e=>(this.categoryRefDtos=e,e)))}getCandidateHistory(e){return this.http.get(this.apiUrl+"CallRecord/bycandidateid/"+e)}getOrAddCallRecord(e){var s=(0,p.qb)(e);return this.http.get(this.apiUrl+"CallRecord/getOrAddHistoryWithItems",{observe:"response",params:s})}getHistoryByParams(e){let s=(0,p.qb)(e);return this.http.get(this.apiUrl+"CallRecord/dto",{observe:"response",params:s})}getUserHistoryPaged(e){const s=this.cache.get(Object.values(e).join("-"));if(s)return(0,m.of)(s);let n=(0,p.qb)(e);return(0,p.Tr)(this.apiUrl+"CallRecord/pagedlist",n,this.http).pipe((0,b.U)(r=>(this.cache.set(Object.values(e).join("-"),r),r)))}deleteUserHistoryById(e){return this.http.delete(this.apiUrl+"CallRecord/deletehist/"+e)}updateUserHistory(e){return this.http.put(this.apiUrl+"CallRecord",e)}composeEmailMessageOfConsent(){}static#t=this.\u0275fac=function(s){return new(s||i)(t.LFG(M.eN),t.LFG(g._W))};static#e=this.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var E=o(7411),x=o(2051),y=o(7783),d=o(7133),I=o(7012),L=o(3574);function H(i,h){if(1&i){const e=t.EpF();t.TgZ(0,"div")(1,"div",1),t._uU(2),t.qZA(),t.TgZ(3,"div",2),t._uU(4),t.qZA(),t.TgZ(5,"div",3),t._uU(6),t.qZA(),t.TgZ(7,"div",1),t._uU(8),t.qZA(),t.TgZ(9,"div",3),t._uU(10),t.qZA(),t.TgZ(11,"div",2),t._uU(12),t.qZA(),t.TgZ(13,"button",4),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.editClicked())}),t.qZA(),t.TgZ(14,"button",5),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.callByPhone())}),t.qZA(),t.TgZ(15,"button",6),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.sendEmail())}),t.qZA(),t.TgZ(16,"button",7),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.deleteClicked())}),t.qZA()()}if(2&i){const e=t.oxw();t.xp6(2),t.Oqu(e.hist.personName),t.xp6(2),t.Oqu(e.hist.categoryRef),t.xp6(2),t.Oqu(e.hist.source),t.xp6(2),t.Oqu(e.hist.email),t.xp6(2),t.Oqu(e.hist.phoneNo),t.xp6(2),t.Oqu(e.hist.status)}}let k=(()=>{class i{constructor(e,s){this.service=e,this.toastr=s,this.editEvent=new t.vpe,this.deleteEvent=new t.vpe}ngOnInit(){}editClicked(){this.service.getCallRecordWithItems(this.hist.personType,this.hist.personId).subscribe({next:e=>{this.editEvent.emit(e)},error:e=>this.toastr.warning(e.error.text,"Failed to retrieve the call record")})}deleteClicked(){this.deleteEvent.emit(this.hist?.id)}callByPhone(){}sendEmail(){}static#t=this.\u0275fac=function(s){return new(s||i)(t.Y36(L.C),t.Y36(g._W))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-call-records-item"]],inputs:{hist:"hist"},outputs:{editEvent:"editEvent",deleteEvent:"deleteEvent"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"stdd","w175"],[1,"stdd","w150"],[1,"stdd","w100"],["title","click to add/edit transations",1,"btn","btn","fa","fa-pencil",3,"click"],["title","register conversation by phone",1,"btn","btn","fa","fa-phone",3,"click"],["title","advise conversation to the person by email",1,"btn","btn","fa","fa-envelope",3,"click"],["title","click to delete this record along with all its related child records",1,"btn","btn","fa","fa-trash","red",3,"click"]],template:function(s,n){1&s&&t.YNc(0,H,17,6,"div",0),2&s&&t.Q6J("ngIf",null!=n.hist)},dependencies:[c.O5],styles:[".stdd[_ngcontent-%COMP%]{display:inline-block;vertical-align:top;font-size:smaller;margin:0 2px;word-wrap:normal}.w100[_ngcontent-%COMP%]{width:100px}.w150[_ngcontent-%COMP%]{width:150px}.w175[_ngcontent-%COMP%]{width:175px}.red[_ngcontent-%COMP%]{color:red}.btn[_ngcontent-%COMP%]{color:#f0f8ff}"]})}return i})();const S=["search"];function F(i,h){if(1&i){const e=t.EpF();t.TgZ(0,"div",8)(1,"pagination",9),t.NdJ("pageChanged",function(n){t.CHM(e);const r=t.oxw();return t.KtG(r.onPageChanged(n))}),t._uU(2," >"),t.qZA(),t.TgZ(3,"input",10,11),t.NdJ("keyup.enter",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onSearch())}),t.qZA(),t.TgZ(5,"button",12),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onSearch())}),t.qZA(),t.TgZ(6,"button",13),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onReset())}),t.qZA(),t._UZ(7,"button",14),t.qZA()}if(2&i){const e=t.oxw();t.xp6(1),t.Q6J("totalItems",e.pagination.totalItems)("itemsPerPage",e.pagination.itemsPerPage)("maxSize",10)}}function J(i,h){1&i&&(t.TgZ(0,"div",15)(1,"h4",16),t._uU(2,"No call records on record as per parameters given"),t.qZA()())}function q(i,h){if(1&i){const e=t.EpF();t.TgZ(0,"div")(1,"app-call-records-item",18),t.NdJ("editEvent",function(n){const a=t.CHM(e).$implicit,l=t.oxw(2);return t.KtG(l.editCallRecord(n,a))})("deleteEvent",function(n){t.CHM(e);const r=t.oxw(2);return t.KtG(r.deleteCallRecord(n))}),t.qZA()()}if(2&i){const e=h.$implicit;t.xp6(1),t.Q6J("hist",e)}}function Y(i,h){if(1&i&&(t.TgZ(0,"div"),t.YNc(1,q,2,1,"div",17),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.callRecords)}}let _=(()=>{class i{constructor(e,s,n,r,a,l,f){this.service=e,this.confirm=s,this.toastr=n,this.bsModalRef=r,this.accountService=a,this.bsModalService=l,this.router=f,this.callRecords=[],this.oParams=new u,this.totalCount=0,this.contactResults=[],this.userHistoryParams=new u,this.accountService.currentUser$.pipe((0,C.q)(1)).subscribe(j=>this.user=j)}ngOnInit(){this.getCallRecords(this.userHistoryParams),this.contactResults=this.service.getContactResults()}getCallRecords(e){this.service.getUserHistoryPaged(e).subscribe({next:s=>{s.result&&s.pagination&&(this.callRecords=s.result,this.pagination=s.pagination,this.totalCount=s.count)}})}onPageChanged(e){const s=this.service.getParams()??new u;s.pageNumber!==e&&(s.pageNumber=e.page,this.service.setParams(s),this.getCallRecords(s))}deleteCallRecord(e){this.confirm.confirm("confirm delete this Order","confirm delete order").pipe((0,T.h)(n=>n),(0,U.w)(n=>this.service.deleteUserHistoryById(e).pipe((0,R.K)(r=>(console.log("Error in deleting the Call Record",r),(0,m.of)())),(0,A.b)(r=>this.toastr.success("deleted the Call Recorrd")))),(0,R.K)(n=>(this.toastr.error("Error in getting delete confirmation",n),(0,m.of)()))).subscribe(()=>{console.log("delete succeeded"),this.toastr.success("Call Record deleted")},n=>{console.log("any error NOT handed in catchError() or if throwError() is returned instead of of() inside catcherror()",n)})}editCallRecord(e,s){null!==e?(this.bsModalRef=this.bsModalService.show(w.h,{class:"modal-dialog-centered modal-lg",initialState:{callRecord:e,status:s.status,candidateName:s.personName,categoryRef:s.categoryName}}),this.bsModalRef.content.updateCallRecordEvent.subscribe({next:a=>{if(""===a.strError){s.status=a.status;var l=this.callRecords.findIndex(f=>f.id==s.id);l>=0&&(this.callRecords[l]=s),this.toastr.success("The Call Record was updated","success")}else this.toastr.warning("Failed to update the call Record","Failed")},error:a=>this.toastr.error(a,"Error encountered")})):this.toastr.warning("No Call Record object returned by call record item")}onSearch(){const e=this.service.getParams();e.search=this.searchTerm?.nativeElement.value,e.pageNumber=1,this.service.setParams(e),this.getCallRecords(e)}onReset(){}static#t=this.\u0275fac=function(s){return new(s||i)(t.Y36(N),t.Y36(E.z),t.Y36(g._W),t.Y36(x.UZ),t.Y36(y.B),t.Y36(x.tT),t.Y36(d.F0))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-call-records-list"]],viewQuery:function(s,n){if(1&s&&t.Gf(S,5),2&s){let r;t.iGM(r=t.CRH())&&(n.searchTerm=r.first)}},decls:18,vars:3,consts:[[2,"display","inline-block","font-size","bold"],["style","display: inline-block; margin-left: 15px; vertical-align: top;",4,"ngIf"],[1,"form-inline",2,"margin-left","50px"],[1,"lbl","w175"],[1,"lbl","w150"],[1,"lbl","w100"],["class","my-2",4,"ngIf"],[4,"ngIf"],[2,"display","inline-block","margin-left","15px","vertical-align","top"],["previousText","\u2039","nextText","\u203a","firstText","\xab","lastText","\xbb",2,"display","inline-block",3,"totalItems","itemsPerPage","maxSize","pageChanged"],["type","text","placeholder","Search",1,"stdd","form-control","w175",3,"keyup.enter"],["search",""],["title","search the records based upon search string entered",1,"btn","fa","fa-search","fa-2x","mx-1",3,"click"],["title","clears all search parameters",1,"btn","fa","fa-refresh","fa-2x","mx-1",3,"click"],["title","go back to Administration Menu","routerLink","/",1,"btn","fa","fa-window-close","fa-2x","mx-1"],[1,"my-2"],[1,"red"],[4,"ngFor","ngForOf"],[3,"hist","editEvent","deleteEvent"]],template:function(s,n){1&s&&(t.TgZ(0,"h4",0),t._uU(1,"Call Records Listing"),t.qZA(),t.YNc(2,F,8,3,"div",1),t.TgZ(3,"div",2)(4,"label",3),t._uU(5,"Name"),t.qZA(),t.TgZ(6,"label",4),t._uU(7,"CategoryRef"),t.qZA(),t.TgZ(8,"label",5),t._uU(9,"Source"),t.qZA(),t.TgZ(10,"label",3),t._uU(11,"Email"),t.qZA(),t.TgZ(12,"label",5),t._uU(13,"Phone No"),t.qZA(),t.TgZ(14,"label",4),t._uU(15,"Status"),t.qZA(),t.YNc(16,J,3,0,"div",6),t.YNc(17,Y,2,1,"div",7),t.qZA()),2&s&&(t.xp6(2),t.Q6J("ngIf",void 0!==n.pagination),t.xp6(14),t.Q6J("ngIf",!n.callRecords||0===n.callRecords.length),t.xp6(1),t.Q6J("ngIf",n.callRecords))},dependencies:[c.sg,c.O5,I.Qt,d.rH,k],styles:[".lbl[_ngcontent-%COMP%]{display:inline-block;vertical-align:middle;font-weight:700;font-size:smaller;margin:0 2px;word-wrap:normal}.stdd[_ngcontent-%COMP%]{display:inline-block!important}.b[_ngcontent-%COMP%]{font-weight:700}.w100[_ngcontent-%COMP%]{width:100px}.w150[_ngcontent-%COMP%]{width:150px}.w175[_ngcontent-%COMP%]{width:175px}.red[_ngcontent-%COMP%]{color:red}.btn[_ngcontent-%COMP%]{color:#f0f8ff}"]})}return i})();const B=[{path:"",component:(()=>{class i{constructor(e){this.accountService=e,this.hasAdminRole=!1,this.accountService.currentUser$.pipe((0,C.q)(1)).subscribe(s=>this.user=s),this.hasAdminRole=void 0!==this.user&&this.user.roles.includes("Admin")}static#t=this.\u0275fac=function(s){return new(s||i)(t.Y36(y.B))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-call-record-menu"]],decls:13,vars:2,consts:[[1,"container","d-flex","justify-contents-between","align-items-center","mt-5"],["routerLink","/callRecords/callRecordList","title","List of Pending Call Records - for admin role",3,"disabled"],["routerLink","/callRecords/callRecordListLoggedinUsername","title","Display active Call Records for logged in User"],["routerLink","/candidates/candidatehistory","title","Candidate history"]],template:function(s,n){1&s&&(t.TgZ(0,"div",0)(1,"button",1),t._uU(2,"Active Call Records"),t._UZ(3,"br"),t._uU(4,"of All users"),t.qZA(),t.TgZ(5,"button",2),t._uU(6,"Active Call Records"),t._UZ(7,"br"),t._uU(8),t.qZA(),t.TgZ(9,"button",3),t._uU(10,"Candidate History"),t.qZA(),t.TgZ(11,"button",3),t._uU(12,"Candidate History"),t.qZA()()),2&s&&(t.xp6(1),t.Q6J("disabled",!n.hasAdminRole),t.xp6(7),t.hij("Of ",n.user.knownAs,""))},dependencies:[d.rH]})}return i})()},{path:"callRecordList",component:_},{path:"callRecordListLoggedinUsername",component:_}];let G=(()=>{class i{static#t=this.\u0275fac=function(s){return new(s||i)};static#e=this.\u0275mod=t.oAB({type:i});static#s=this.\u0275inj=t.cJS({imports:[c.ez,d.Bz.forChild(B),d.Bz]})}return i})();var z=o(617);let K=(()=>{class i{static#t=this.\u0275fac=function(s){return new(s||i)};static#e=this.\u0275mod=t.oAB({type:i});static#s=this.\u0275inj=t.cJS({imports:[c.ez,Z.m,G,z.Ps]})}return i})()}}]);