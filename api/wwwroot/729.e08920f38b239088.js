"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[729],{8729:(K,f,o)=>{o.r(f),o.d(f,{CallRecordModule:()=>Y});var l=o(6814),x=o(3983),_=o(2181),y=o(4664),C=o(6306),g=o(2096),Z=o(9397),w=o(369);class d{constructor(){this.id=0,this.personType="",this.incomingOutgoing="",this.dateOfContact=new Date,this.personId="",this.mobileNo="",this.emailId="",this.categoryRef="",this.status="",this.statusClass="Active",this.username="",this.gistOfDiscussions="",this.advisoryBy="",this.nextAction="",this.nextActionOn=new Date,this.subject="",this.search="",this.sort="",this.pageNumber=1,this.pageSize=10}}var t=o(5879),T=o(7328),v=o(7398),A=o(5516),h=o(1436),U=o(9862),m=o(8763);let O=(()=>{class i{constructor(e,s){this.http=e,this.toastr=s,this.apiUrl=A.N.apiUrl,this.currentUserSource=new T.t(1),this.currentUser$=this.currentUserSource.asObservable(),this.histParams=new d,this.categoryRefDtos=[],this.cache=new Map,this.contactResults=[{status:"Not Reachable"},{status:"Wrong Number"},{status:"Declined-Family Issues"},{status:"Declined-Low Remuneration"},{status:"Declined-Other Reasons"},{status:"Will Call later"},{status:"Not interested for overseas"},{status:"Declined-Service Charges"}]}getContactResults(){return this.contactResults}setParams(e){this.histParams=e}getParams(){return this.histParams}getCategoryRefDetails(){return this.http.get(this.apiUrl+"categoryrefdetails").pipe((0,v.U)(e=>(this.categoryRefDtos=e,e)))}getCandidateHistory(e){return this.http.get(this.apiUrl+"CallRecord/bycandidateid/"+e)}getOrAddCallRecord(e){var s=(0,h.qb)(e);return this.http.get(this.apiUrl+"CallRecord/getOrAddHistoryWithItems",{observe:"response",params:s})}getHistoryByParams(e){let s=(0,h.qb)(e);return this.http.get(this.apiUrl+"CallRecord/dto",{observe:"response",params:s})}getUserHistoryPaged(e){const s=this.cache.get(Object.values(e).join("-"));if(s)return(0,g.of)(s);let n=(0,h.qb)(e);return(0,h.Tr)(this.apiUrl+"CallRecord/pagedlist",n,this.http).pipe((0,v.U)(r=>(this.cache.set(Object.values(e).join("-"),r),r)))}deleteUserHistoryById(e){return this.http.delete(this.apiUrl+"CallRecord/deletehist/"+e)}updateUserHistory(e){return this.http.put(this.apiUrl+"CallRecord",e)}composeEmailMessageOfConsent(){}static#t=this.\u0275fac=function(s){return new(s||i)(t.LFG(U.eN),t.LFG(m._W))};static#e=this.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var M=o(7411),R=o(2051),P=o(7012),u=o(7133),N=o(3574);function E(i,c){if(1&i){const e=t.EpF();t.TgZ(0,"div"),t._UZ(1,"div",1),t.TgZ(2,"div",2),t._uU(3),t.qZA(),t.TgZ(4,"div",3),t._uU(5),t.qZA(),t.TgZ(6,"div",4),t._uU(7),t.qZA(),t.TgZ(8,"div",2),t._uU(9),t.qZA(),t.TgZ(10,"div",4),t._uU(11),t.qZA(),t.TgZ(12,"div",4),t._uU(13),t.qZA(),t.TgZ(14,"button",5),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.editClicked())}),t.qZA(),t.TgZ(15,"button",6),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.callByPhone())}),t.qZA(),t.TgZ(16,"button",7),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.sendEmail())}),t.qZA(),t.TgZ(17,"button",8),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.deleteClicked())}),t.qZA()()}if(2&i){const e=t.oxw();t.xp6(3),t.Oqu(e.hist.personName),t.xp6(2),t.Oqu(e.hist.categoryRef),t.xp6(2),t.Oqu(e.hist.source),t.xp6(2),t.Oqu(e.hist.email),t.xp6(2),t.Oqu(e.hist.phoneNo),t.xp6(2),t.Oqu(e.hist.status)}}let I=(()=>{class i{constructor(e,s){this.service=e,this.toastr=s,this.editEvent=new t.vpe,this.deleteEvent=new t.vpe}ngOnInit(){}editClicked(){this.service.getCallRecordWithItems(this.hist.personType,this.hist.personId).subscribe({next:e=>{this.editEvent.emit(e)},error:e=>this.toastr.warning(e.error.text,"Failed to retrieve the call record")})}deleteClicked(){this.deleteEvent.emit(this.hist?.id)}callByPhone(){}sendEmail(){}static#t=this.\u0275fac=function(s){return new(s||i)(t.Y36(N.C),t.Y36(m._W))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-call-records-item"]],inputs:{hist:"hist"},outputs:{editEvent:"editEvent",deleteEvent:"deleteEvent"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"stdd","w75"],[1,"stdd","w175"],[1,"stdd","w150"],[1,"stdd","w100"],["title","click to add/edit transations",1,"btn","btn","fa","fa-pencil",3,"click"],["title","register conversation by phone",1,"btn","btn","fa","fa-phone",3,"click"],["title","advise conversation to the person by email",1,"btn","btn","fa","fa-envelope",3,"click"],["title","click to delete this record along with all its related child records",1,"btn","btn","fa","fa-trash","red",3,"click"]],template:function(s,n){1&s&&t.YNc(0,E,18,6,"div",0),2&s&&t.Q6J("ngIf",null!=n.hist)},dependencies:[l.O5],styles:[".stdd[_ngcontent-%COMP%]{display:inline-block;vertical-align:top;font-size:smaller;margin-left:1px;margin-right:1px;word-wrap:normal}.w50[_ngcontent-%COMP%]{width:50px}.w75[_ngcontent-%COMP%]{width:75px}.w100[_ngcontent-%COMP%]{width:100px}.w150[_ngcontent-%COMP%]{width:150px}.w175[_ngcontent-%COMP%]{width:175px}.red[_ngcontent-%COMP%]{color:red}"]})}return i})();const L=["search"];function H(i,c){if(1&i){const e=t.EpF();t.TgZ(0,"div",9)(1,"pagination",10),t.NdJ("pageChanged",function(n){t.CHM(e);const r=t.oxw();return t.KtG(r.onPageChanged(n))}),t._uU(2," >"),t.qZA(),t.TgZ(3,"input",11,12),t.NdJ("keyup.enter",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onSearch())}),t.qZA(),t.TgZ(5,"button",13),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onSearch())}),t.qZA(),t.TgZ(6,"button",14),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.onReset())}),t.qZA(),t._UZ(7,"button",15),t.qZA()}if(2&i){const e=t.oxw();t.xp6(1),t.Q6J("totalItems",e.pagination.totalItems)("itemsPerPage",e.pagination.itemsPerPage)("maxSize",10)}}function k(i,c){1&i&&(t.TgZ(0,"div",16)(1,"h4",17),t._uU(2,"No call records on record as per parameters given"),t.qZA()())}function S(i,c){if(1&i){const e=t.EpF();t.TgZ(0,"div")(1,"app-call-records-item",19),t.NdJ("editEvent",function(n){const a=t.CHM(e).$implicit,p=t.oxw(2);return t.KtG(p.editCallRecord(n,a))})("deleteEvent",function(n){t.CHM(e);const r=t.oxw(2);return t.KtG(r.deleteCallRecord(n))}),t.qZA()()}if(2&i){const e=c.$implicit;t.xp6(1),t.Q6J("hist",e)}}function J(i,c){if(1&i&&(t.TgZ(0,"div"),t.YNc(1,S,2,1,"div",18),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.callRecords)}}let b=(()=>{class i{constructor(e,s,n,r,a){this.service=e,this.confirm=s,this.toastr=n,this.bsModalRef=r,this.bsModalService=a,this.callRecords=[],this.oParams=new d,this.totalCount=0,this.contactResults=[],this.userHistoryParams=new d}ngOnInit(){this.getCallRecords(this.userHistoryParams),console.log("callRecords:",this.callRecords),this.contactResults=this.service.getContactResults()}getCallRecords(e){this.service.getUserHistoryPaged(e).subscribe({next:s=>{s.result&&s.pagination&&(this.callRecords=s.result,this.pagination=s.pagination,this.totalCount=s.count)}})}onPageChanged(e){const s=this.service.getParams()??new d;s.pageNumber!==e&&(s.pageNumber=e.page,this.service.setParams(s),this.getCallRecords(s))}deleteCallRecord(e){this.confirm.confirm("confirm delete this Order","confirm delete order").pipe((0,_.h)(n=>n),(0,y.w)(n=>this.service.deleteUserHistoryById(e).pipe((0,C.K)(r=>(console.log("Error in deleting the Call Record",r),(0,g.of)())),(0,Z.b)(r=>this.toastr.success("deleted the Call Recorrd")))),(0,C.K)(n=>(this.toastr.error("Error in getting delete confirmation",n),(0,g.of)()))).subscribe(()=>{console.log("delete succeeded"),this.toastr.success("Call Record deleted")},n=>{console.log("any error NOT handed in catchError() or if throwError() is returned instead of of() inside catcherror()",n)})}editCallRecord(e,s){null!==e?(console.log("call record edit:",e),this.bsModalRef=this.bsModalService.show(w.h,{class:"modal-dialog-centered modal-lg",initialState:{callRecord:e,status:s.status,candidateName:s.personName,categoryRef:s.categoryName}}),this.bsModalRef.content.updateCallRecordEvent.subscribe({next:a=>{if(""===a.strError){s.status=a.status;var p=this.callRecords.findIndex(z=>z.id==s.id);p>=0&&(this.callRecords[p]=s),this.toastr.success("The Call Record was updated","success")}else this.toastr.warning("Failed to update the call Record","Failed")},error:a=>this.toastr.error(a,"Error encountered")})):this.toastr.warning("No Call Record object returned by call record item")}onSearch(){const e=this.service.getParams();e.search=this.searchTerm?.nativeElement.value,e.pageNumber=1,this.service.setParams(e),this.getCallRecords(e)}onReset(){}static#t=this.\u0275fac=function(s){return new(s||i)(t.Y36(O),t.Y36(M.z),t.Y36(m._W),t.Y36(R.UZ),t.Y36(R.tT))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-call-records-list"]],viewQuery:function(s,n){if(1&s&&t.Gf(L,5),2&s){let r;t.iGM(r=t.CRH())&&(n.searchTerm=r.first)}},decls:20,vars:3,consts:[[2,"display","inline-block","font-size","bold"],["style","display: inline-block; margin-left: 15px; vertical-align: top;",4,"ngIf"],[1,"form-inline",2,"margin-left","50px"],[1,"lbl","w75"],[1,"lbl","w175"],[1,"lbl","w150"],[1,"lbl","w100"],["class","my-2",4,"ngIf"],[4,"ngIf"],[2,"display","inline-block","margin-left","15px","vertical-align","top"],["previousText","\u2039","nextText","\u203a","firstText","\xab","lastText","\xbb",2,"display","inline-block",3,"totalItems","itemsPerPage","maxSize","pageChanged"],["type","text","placeholder","Search",1,"stdd","form-control","w300",3,"keyup.enter"],["search",""],["title","search the records based upon search string entered",1,"btn","fa","fa-search","fa-2x","mx-1",3,"click"],["title","clears all search parameters",1,"btn","fa","fa-refresh","fa-2x","mx-1",3,"click"],["title","go back to Administration Menu","routerLink","/candidates",1,"btn","fa","fa-window-close","fa-2x","mx-1"],[1,"my-2"],[1,"red"],[4,"ngFor","ngForOf"],[3,"hist","editEvent","deleteEvent"]],template:function(s,n){1&s&&(t.TgZ(0,"h4",0),t._uU(1,"Call Records Listing"),t.qZA(),t.YNc(2,H,8,3,"div",1),t.TgZ(3,"div",2)(4,"label",3),t._uU(5,"App No"),t.qZA(),t.TgZ(6,"label",4),t._uU(7,"Name"),t.qZA(),t.TgZ(8,"label",5),t._uU(9,"CategoryRef"),t.qZA(),t.TgZ(10,"label",6),t._uU(11,"Source"),t.qZA(),t.TgZ(12,"label",4),t._uU(13,"Email"),t.qZA(),t.TgZ(14,"label",6),t._uU(15,"Phone No"),t.qZA(),t.TgZ(16,"label",6),t._uU(17,"Status"),t.qZA(),t.YNc(18,k,3,0,"div",7),t.YNc(19,J,2,1,"div",8),t.qZA()),2&s&&(t.xp6(2),t.Q6J("ngIf",void 0!==n.pagination),t.xp6(16),t.Q6J("ngIf",!n.callRecords||0===n.callRecords.length),t.xp6(1),t.Q6J("ngIf",n.callRecords))},dependencies:[l.sg,l.O5,P.Qt,u.rH,I],styles:[".lbl[_ngcontent-%COMP%]{display:inline-block;vertical-align:middle;font-weight:700;font-size:smaller;margin-left:1px;margin-right:1px;word-wrap:normal}.stdd[_ngcontent-%COMP%]{display:inline-block!important}.b[_ngcontent-%COMP%]{font-weight:700}.w50[_ngcontent-%COMP%]{width:50px}.w75[_ngcontent-%COMP%]{width:75px}.w100[_ngcontent-%COMP%]{width:100px}.w150[_ngcontent-%COMP%]{width:150px}.w175[_ngcontent-%COMP%]{width:175px}.w200[_ngcontent-%COMP%]{width:200px}.w300[_ngcontent-%COMP%]{width:300px}.red[_ngcontent-%COMP%]{color:red}"]})}return i})();var q=o(8180),F=o(7783);const B=[{path:"",component:(()=>{class i{constructor(e){this.accountService=e,this.hasAdminRole=!1,this.accountService.currentUser$.pipe((0,q.q)(1)).subscribe(s=>this.user=s),this.hasAdminRole=void 0!==this.user&&this.user.roles.includes("Admin")}static#t=this.\u0275fac=function(s){return new(s||i)(t.Y36(F.B))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-call-record-menu"]],decls:13,vars:2,consts:[[1,"container","d-flex","justify-contents-between","align-items-center","mt-5"],["routerLink","/callRecords/callRecordList","title","List of Pending Call Records - for admin role",3,"disabled"],["routerLink","/callRecords/callRecordListLoggedinUsername","title","Display active Call Records for logged in User"],["routerLink","/candidates/candidatehistory","title","Candidate history"]],template:function(s,n){1&s&&(t.TgZ(0,"div",0)(1,"button",1),t._uU(2,"Active Call Records"),t._UZ(3,"br"),t._uU(4,"of All users"),t.qZA(),t.TgZ(5,"button",2),t._uU(6,"Active Call Records"),t._UZ(7,"br"),t._uU(8),t.qZA(),t.TgZ(9,"button",3),t._uU(10,"Candidate History"),t.qZA(),t.TgZ(11,"button",3),t._uU(12,"Candidate History"),t.qZA()()),2&s&&(t.xp6(1),t.Q6J("disabled",!n.hasAdminRole),t.xp6(7),t.hij("Of ",n.user.knownAs,""))},dependencies:[u.rH]})}return i})()},{path:"callRecordList",component:b},{path:"callRecordListLoggedinUsername",component:b}];let G=(()=>{class i{static#t=this.\u0275fac=function(s){return new(s||i)};static#e=this.\u0275mod=t.oAB({type:i});static#s=this.\u0275inj=t.cJS({imports:[l.ez,u.Bz.forChild(B),u.Bz]})}return i})(),Y=(()=>{class i{static#t=this.\u0275fac=function(s){return new(s||i)};static#e=this.\u0275mod=t.oAB({type:i});static#s=this.\u0275inj=t.cJS({imports:[l.ez,x.m,G]})}return i})()}}]);