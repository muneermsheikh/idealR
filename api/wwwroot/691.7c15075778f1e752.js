"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[691],{5691:(U,h,r)=>{r.r(h),r.d(h,{MessageModule:()=>D});var c=r(177),m=r(9417),f=r(9485),_=r(4056),M=r(5964),b=r(5558),p=r(2568),e=r(7705),v=r(8882),C=r(8256),k=r(778),T=r(3400),I=r(4722),j=r(2510),P=r(6295),u=r(5743);const x=["searchInUsernames"],y=["searchInContents"];function w(o,d){if(1&o){const t=e.RV6();e.j41(0,"pagination",25),e.bIt("ngModelChange",function(s){e.eBV(t);const n=e.XpG();return e.Njj(n.pagination.currentPage=s)})("pageChanged",function(s){e.eBV(t);const n=e.XpG();return e.Njj(n.pageChanged(s))}),e.k0s()}if(2&o){const t=e.XpG();e.Y8G("boundaryLinks",!0)("totalItems",t.pagination.totalItems)("itemsPerPage",t.pagination.itemsPerPage)("ngModel",t.pagination.currentPage)("maxSize",15)}}function E(o,d){1&o&&(e.j41(0,"div",26)(1,"h3"),e.EFF(2,"No messages"),e.k0s()())}function F(o,d){if(1&o){const t=e.RV6();e.j41(0,"div")(1,"div",34),e.bIt("click",function(){const n=e.eBV(t).$implicit,a=e.XpG(3);return e.Njj(a.msgClicked(n))}),e.EFF(2),e.nI1(3,"date"),e.k0s(),e.j41(4,"div",35),e.bIt("click",function(){const n=e.eBV(t).$implicit,a=e.XpG(3);return e.Njj(a.msgClicked(n))}),e.EFF(5),e.k0s(),e.j41(6,"div",36),e.bIt("click",function(){const n=e.eBV(t).$implicit,a=e.XpG(3);return e.Njj(a.msgClicked(n))}),e.EFF(7),e.k0s(),e.j41(8,"button",37),e.bIt("click",function(){const n=e.eBV(t).$implicit,a=e.XpG(3);return e.Njj(a.removeMessage(n.id))}),e.k0s()()}if(2&o){const t=d.$implicit;e.R7$(2),e.JRh(e.i5U(3,4,t.messageComposedOn,"dd-MMM-yy")),e.R7$(3),e.Lme("",t.senderUsername," [",t.senderEmail,"]"),e.R7$(2),e.JRh(t.subject)}}function G(o,d){if(1&o&&(e.j41(0,"div")(1,"label",30),e.EFF(2,"Date"),e.k0s(),e.j41(3,"label",31),e.EFF(4,"From"),e.k0s(),e.j41(5,"label",32),e.EFF(6,"Subject"),e.k0s(),e.DNE(7,F,9,7,"div",33),e.k0s()),2&o){const t=e.XpG(2);e.R7$(7),e.Y8G("ngForOf",t.messages)}}function R(o,d){if(1&o){const t=e.RV6();e.j41(0,"div")(1,"div",40),e.bIt("click",function(){const n=e.eBV(t).$implicit,a=e.XpG(3);return e.Njj(a.msgClicked(n))}),e.EFF(2),e.nI1(3,"date"),e.k0s(),e.j41(4,"div",41),e.bIt("click",function(){const n=e.eBV(t).$implicit,a=e.XpG(3);return e.Njj(a.msgClicked(n))}),e.EFF(5),e.k0s(),e.j41(6,"div",42),e.bIt("click",function(){const n=e.eBV(t).$implicit,a=e.XpG(3);return e.Njj(a.msgClicked(n))}),e.EFF(7),e.k0s(),e.j41(8,"button",43),e.bIt("click",function(){const n=e.eBV(t).$implicit,a=e.XpG(3);return e.Njj(a.removeMessage(n.id))}),e.k0s()()}if(2&o){const t=d.$implicit;e.R7$(2),e.JRh(e.i5U(3,4,t.messageComposedOn,"ddMMMyy")),e.R7$(3),e.JRh(t.recipientEmail),e.R7$(2),e.Lme("",t.subject," - ",t.id,"")}}function $(o,d){if(1&o&&(e.j41(0,"div",38)(1,"label",30),e.EFF(2,"Date"),e.k0s(),e.j41(3,"label",31),e.EFF(4,"To"),e.k0s(),e.j41(5,"label",39),e.EFF(6,"Subject"),e.k0s(),e.DNE(7,R,9,7,"div",33),e.k0s()),2&o){const t=e.XpG(2);e.R7$(7),e.Y8G("ngForOf",t.messages)}}function N(o,d){if(1&o&&(e.j41(0,"div",27),e.DNE(1,G,8,1,"div",28),e.DNE(2,$,8,1,"div",29),e.k0s()),2&o){const t=e.XpG();e.R7$(1),e.Y8G("ngIf","Inbox"===t.container),e.R7$(1),e.Y8G("ngIf","Outbox"===t.container)}}const O=[{path:"messages",component:(()=>{class o{constructor(t,i,s){this.service=t,this.toastr=i,this.confirm=s,this.messages=[],this.msgParams=new p.a,this.container="Inbox",this.loading=!1,this.messageSentOn=new Date,this.dtMsgSentMoreThan2000=!1,this.iMessageId=0,this.msgToDisplay="",this.toEmailId="",this.ccEmailId="",this.subject="",this.lastContainer="",this.lastMessageType="",this.currentPage=0,this.msgTypes=[],this.editorConfig={editable:!0,spellcheck:!0,height:"auto",minHeight:"0",maxHeight:"auto",width:"auto",minWidth:"0",translate:"yes",enableToolbar:!0,showToolbar:!0,placeholder:"Enter text here...",defaultParagraphSeparator:"",defaultFontName:"",defaultFontSize:"",fonts:[{class:"arial",name:"Arial"},{class:"times-new-roman",name:"Times New Roman"},{class:"calibri",name:"Calibri"},{class:"comic-sans-ms",name:"Comic Sans MS"}],customClasses:[{name:"quote",class:"quote"},{name:"redText",class:"redText"},{name:"titleText",class:"titleText",tag:"h1"}],uploadWithCredentials:!1,sanitize:!0,toolbarPosition:"top",toolbarHiddenButtons:[["bold","italic"],["fontSize"]]},this.msgTypes=this.service.getMessageTypes()}ngOnInit(){}loadMessages(t=!1){""!==this.msgParams.messageType?(console.log("currentpage:",this.currentPage,"params page",this.msgParams.pageNumber),(this.container!==this.lastContainer||this.msgParams.messageType!==this.lastMessageType&&""!==this.lastMessageType||this.msgParams.pageNumber!==this.currentPage)&&(this.lastMessageType=this.msgParams.messageType,this.loading=!0,this.service.setParams(this.msgParams),this.service.getMessages(t).subscribe({next:i=>{this.messages=i.result,this.pagination=i.pagination,this.loading=!1,this.currentPage=this.msgParams.pageNumber}}),this.lastContainer=this.container)):this.toastr.warning("Please select the Message Type before selecting the container","Message Type Not Selected")}deleteMessage(t){this.service.deleteMessage(t).subscribe({next:i=>{if(console.log("reponse:",i),"Marked as Deleted"===i?this.toastr.success("Message Marked as Deleted","Success"):"Deleted"===i&&this.toastr.success("Message Deleted","Success"),"Deleted"===i||"Marked as Deleted"===i){var s=this.messages?.findIndex(n=>n.id===t);-1!==s&&this.messages?.splice(s,1)}},error:i=>this.toastr.error(i.error?.details,"Error encountered")})}pageChanged(t){this.msgParams.pageNumber!==t.page&&(this.msgParams.pageNumber=t.page,this.loadMessages())}msgClicked(t){this.msgToDisplay=t.content,this.messageSentOn=t.messageSent,this.iMessageId=t.id,this.dtMsgSentMoreThan2000=this.messageSentOn>new Date("2000-01-01"),this.subject=t.subject,this.toEmailId=t.recipientEmail}removeMessage(t){const s=this.service.deleteMessage(t);this.confirm.confirm("confirm Delete","confirm delete this Message. WARNING: this cannot be undone").pipe((0,M.p)(a=>a),(0,b.n)(()=>s)).subscribe({next:a=>{if("Unauthorized"===a)this.toastr.warning("The message can be deleted by the sender or the recipient","Unauthorized");else if("Deleted"===a||"Marked as Deleted"===a){this.toastr.success("Message Deleted","Deletion successful");var l=this.messages?.findIndex(g=>g.id==t);-1!==l&&this.messages.splice(l,1)}else this.toastr.error(a,"Failed to delete the message")},error:a=>this.toastr.error(a.error.text,"Error encountered")})}sendMessage(){var t=this.messages?.filter(l=>l.id===this.iMessageId)[0];if(!t)return void this.toastr.warning("failed to retrieve the current message","cannot retrieve message");const n=this.service.sendMessage({senderUsername:t.senderUsername,recipientUsername:t.recipientUsername,ccEmailAddress:"",subject:t.subject,content:this.msgToDisplay,id:t.id});this.confirm.confirm("confirm Send Message","confirm send this Message.").pipe((0,M.p)(l=>l),(0,b.n)(()=>n)).subscribe({next:l=>{if(void 0!==l){this.toastr.success("Message sent","Success");var g=this.messages?.findIndex(B=>B.id==l.id);-1!==g&&this.messages&&l&&this.messages.splice(g,1)}else this.toastr.warning("Failed to send the message","failed to Send")},error:l=>this.toastr.error(l.error.details,"Error encountered")})}onSearchInUsernames(){const t=new p.a;t.search=this.searchTermInUsernames?.nativeElement.value,t.pageNumber=1,this.service.setParams(t),this.loadMessages()}onSearchInContents(){const t=new p.a;t.searchInContents=this.searchTermInContents?.nativeElement.value,t.pageNumber=1,this.service.setParams(t),this.loadMessages()}updateToEmailId(){}static#e=this.\u0275fac=function(i){return new(i||o)(e.rXU(v.b),e.rXU(C.tw),e.rXU(k.G))};static#t=this.\u0275cmp=e.VBU({type:o,selectors:[["app-messages"]],viewQuery:function(i,s){if(1&i&&(e.GBs(x,5),e.GBs(y,5)),2&i){let n;e.mGM(n=e.lsd())&&(s.searchTermInUsernames=n.first),e.mGM(n=e.lsd())&&(s.searchTermInContents=n.first)}},decls:35,vars:21,consts:[[1,"stdd","col-4","my-0",2,"vertical-align","top"],[1,"mb-4","d-flex"],["name","container",1,"btn-group"],["title","Unread messages","btnRadio","Unread","value","unread",1,"btn","btn-primary",3,"ngModel","ngModelChange","click"],[1,"fa","fa-envelope"],["btnRadio","Inbox","title","Inbox messages","value","Inbox",1,"btn","btn-primary",3,"ngModel","ngModelChange","click"],[1,"fa","fa-envelope-open"],["title","sent messages","btnRadio","Outbox","value","Outbox",1,"btn","btn-primary",3,"ngModel","ngModelChange","click"],[1,"fa","fa-paper-plane"],["bindLabel","MessageType","bindValue","MessageType","labelForId","MessageType","clearAllText","Clear",1,"mx-3","w150",3,"items","ngModel","ngModelChange"],["style","display: inline-block;","previousText","\u2039","nextText","\u203a","firstText","\xab","lastText","\xbb",3,"boundaryLinks","totalItems","itemsPerPage","ngModel","maxSize","ngModelChange","pageChanged",4,"ngIf"],["class","row",4,"ngIf"],["class","stdd row","style","vertical-align: top;",4,"ngIf"],[1,"stdd","col-7","my-0",2,"vertical-align","top"],["title","retrieves Email Id from database",1,"btn",3,"disabled","click"],["title","send the message to the addressee",1,"stdd","pull-right","btn","fa","fa-paper-plane","mx-1",2,"color","aliceblue","background-color","grey",3,"disabled","click"],[1,"stdd","w25"],[1,"stdd","w150",3,"ngModel","label","ngModelChange"],[1,"stdd","w25","mx-2"],[1,"stdd","w50"],[1,"stdd","w250",3,"ngModel","label","ngModelChange"],[1,"stdd","w40"],[1,"stdd","w80"],[3,"ngModel","ngModelChange"],["type","button","title","close this window","routerLink","/",1,"btn","fa","fa-window-close","fa-2x",2,"color","aliceblue"],["previousText","\u2039","nextText","\u203a","firstText","\xab","lastText","\xbb",2,"display","inline-block",3,"boundaryLinks","totalItems","itemsPerPage","ngModel","maxSize","ngModelChange","pageChanged"],[1,"row"],[1,"stdd","row",2,"vertical-align","top"],[4,"ngIf"],["class","stdd",4,"ngIf"],[1,"lbl","w80"],[1,"lbl","w100"],[1,"lbl","w250"],[4,"ngFor","ngForOf"],[1,"stdd","cursorPointer","col-2",3,"click"],[1,"stdd","cursorPointer","col-3",3,"click"],[1,"stdd","cursorPointer","col-5",3,"click"],[1,"stdd","btn","col-1","fa","fa-trash","red",3,"click"],[1,"stdd"],[1,"lbl","w300"],[1,"stdd","cursorPointer","w80",3,"click"],[1,"stdd","cursorPointer","w100",3,"click"],[1,"stdd","cursorPointer","w300",3,"click"],[1,"stdd","btn","w35","fa","fa-trash","red",3,"click"]],template:function(i,s){1&i&&(e.j41(0,"div",0)(1,"div",1),e.nrm(2,"br"),e.j41(3,"div",2)(4,"button",3),e.bIt("ngModelChange",function(a){return s.msgParams.container=a})("click",function(){return s.loadMessages()}),e.nrm(5,"i",4),e.k0s(),e.j41(6,"button",5),e.bIt("ngModelChange",function(a){return s.msgParams.container=a})("click",function(){return s.loadMessages()}),e.nrm(7,"i",6),e.k0s(),e.j41(8,"button",7),e.bIt("ngModelChange",function(a){return s.msgParams.container=a})("click",function(){return s.loadMessages()}),e.nrm(9,"i",8),e.k0s()(),e.j41(10,"ng-select",9),e.bIt("ngModelChange",function(a){return s.msgParams.messageType=a}),e.k0s(),e.DNE(11,w,1,5,"pagination",10),e.k0s(),e.DNE(12,E,3,0,"div",11),e.DNE(13,N,3,2,"div",12),e.k0s(),e.j41(14,"div",13)(15,"button",14),e.bIt("click",function(){return s.updateToEmailId()}),e.k0s(),e.j41(16,"button",15),e.bIt("click",function(){return s.sendMessage()}),e.k0s(),e.nrm(17,"br")(18,"br"),e.j41(19,"span",16),e.EFF(20,"To:"),e.k0s(),e.j41(21,"app-text-input",17),e.bIt("ngModelChange",function(a){return s.toEmailId=a}),e.k0s(),e.j41(22,"span",18),e.EFF(23,"CC:"),e.k0s(),e.j41(24,"app-text-input",17),e.bIt("ngModelChange",function(a){return s.ccEmailId=a}),e.k0s(),e.j41(25,"span",19),e.EFF(26,"Subject"),e.k0s(),e.j41(27,"app-text-input",20),e.bIt("ngModelChange",function(a){return s.subject=a}),e.k0s(),e.j41(28,"span",21),e.EFF(29,"Sent On"),e.k0s(),e.j41(30,"div",22),e.EFF(31),e.nI1(32,"date"),e.k0s(),e.j41(33,"angular-editor",23),e.bIt("ngModelChange",function(a){return s.msgToDisplay=a}),e.k0s()(),e.nrm(34,"button",24)),2&i&&(e.R7$(4),e.Y8G("ngModel",s.msgParams.container),e.R7$(2),e.Y8G("ngModel",s.msgParams.container),e.R7$(2),e.Y8G("ngModel",s.msgParams.container),e.R7$(2),e.Y8G("items",s.msgTypes)("ngModel",s.msgParams.messageType),e.R7$(1),e.Y8G("ngIf",!s.loading&&s.pagination&&s.messages&&s.messages.length>0),e.R7$(1),e.Y8G("ngIf",!s.messages||0===(null==s.messages?null:s.messages.length)),e.R7$(1),e.Y8G("ngIf",s.messages&&0!==(null==s.messages?null:s.messages.length)),e.R7$(2),e.Y8G("disabled",null!==s.toEmailId||""!==s.toEmailId),e.R7$(1),e.Y8G("disabled",s.dtMsgSentMoreThan2000||""===s.toEmailId),e.R7$(5),e.Y8G("ngModel",s.toEmailId)("label","To Email"),e.R7$(3),e.Y8G("ngModel",s.ccEmailId)("label","CC"),e.R7$(3),e.Y8G("ngModel",s.subject)("label","Subject"),e.R7$(4),e.JRh(e.i5U(32,18,s.messageSentOn,"ddMMMyy")),e.R7$(2),e.Y8G("ngModel",s.msgToDisplay))},dependencies:[c.Sq,c.bT,m.BC,m.vS,T.eK,I.p4,j.vr,P.f,_.Rj,u.Wk,c.vh],styles:[".stdd[_ngcontent-%COMP%]{display:inline-block;margin:0 2px;font-size:x-small;vertical-align:top;word-wrap:normal;word-break:break-all}.lbl[_ngcontent-%COMP%]{display:inline-block;margin:0 2px;font-size:x-small;font-weight:700;vertical-align:top;word-break:normal;word-wrap:break-word}.cursorPointer[_ngcontent-%COMP%]{cursor:pointer;color:#ff0}.red[_ngcontent-%COMP%]{color:red}.w25[_ngcontent-%COMP%]{width:25px}.w35[_ngcontent-%COMP%]{width:35px}.w40[_ngcontent-%COMP%]{width:40px}.w50[_ngcontent-%COMP%]{width:50px}.w80[_ngcontent-%COMP%]{width:80px}.w100[_ngcontent-%COMP%]{width:100px}.w150[_ngcontent-%COMP%]{width:150px}.w300[_ngcontent-%COMP%]{width:300px}.w250[_ngcontent-%COMP%]{width:250px}"]})}return o})()}];let S=(()=>{class o{static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275mod=e.$C({type:o});static#s=this.\u0275inj=e.G2t({imports:[c.MD,u.iI.forChild(O),u.iI]})}return o})(),D=(()=>{class o{static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275mod=e.$C({type:o});static#s=this.\u0275inj=e.G2t({imports:[c.MD,m.YN,f.G,_.Qt,S]})}return o})()}}]);