"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[729],{8729:(j,f,o)=>{o.r(f),o.d(f,{CallRecordModule:()=>K});var c=o(6814),x=o(4849),C=o(2181),v=o(4664),g=o(6306),h=o(2096),w=o(9397),Z=o(369),T=o(1986);class u{constructor(){this.id=0,this.personType="",this.incomingOutgoing="",this.dateOfContact=new Date,this.personId="",this.mobileNo="",this.emailId="",this.categoryRef="",this.status="",this.statusClass="Active",this.username="",this.gistOfDiscussions="",this.advisoryBy="",this.nextAction="",this.nextActionOn=new Date,this.subject="",this.search="",this.sort="",this.pageNumber=1,this.pageSize=10}}var t=o(9468),O=o(7328),R=o(7398),A=o(5516),p=o(3976),U=o(9862),b=o(8763);let M=(()=>{class n{constructor(e,s){this.http=e,this.toastr=s,this.apiUrl=A.N.apiUrl,this.currentUserSource=new O.t(1),this.currentUser$=this.currentUserSource.asObservable(),this.histParams=new u,this.categoryRefDtos=[],this.cache=new Map,this.contactResults=[{status:"Not Reachable"},{status:"Wrong Number"},{status:"Declined-Family Issues"},{status:"Declined-Low Remuneration"},{status:"Declined-Other Reasons"},{status:"Will Call later"},{status:"Not interested for overseas"},{status:"Declined-Service Charges"}]}getContactResults(){return this.contactResults}setParams(e){this.histParams=e}getParams(){return this.histParams}getCategoryRefDetails(){return this.http.get(this.apiUrl+"categoryrefdetails").pipe((0,R.U)(e=>(this.categoryRefDtos=e,e)))}getCandidateHistory(e){return this.http.get(this.apiUrl+"CallRecord/bycandidateid/"+e)}getOrAddCallRecord(e){var s=(0,p.qb)(e);return this.http.get(this.apiUrl+"CallRecord/getOrAddHistoryWithItems",{observe:"response",params:s})}getHistoryByParams(e){let s=(0,p.qb)(e);return this.http.get(this.apiUrl+"CallRecord/dto",{observe:"response",params:s})}getUserHistoryPaged(e){const s=this.cache.get(Object.values(e).join("-"));if(s)return(0,h.of)(s);let i=(0,p.qb)(e);return(0,p.Tr)(this.apiUrl+"CallRecord/pagedlist",i,this.http).pipe((0,R.U)(r=>(this.cache.set(Object.values(e).join("-"),r),r)))}deleteUserHistoryById(e){return this.http.delete(this.apiUrl+"CallRecord/deletehist/"+e)}updateUserHistory(e){return this.http.put(this.apiUrl+"CallRecord",e)}composeEmailMessageOfConsent(){}static#t=this.\u0275fac=function(s){return new(s||n)(t.LFG(U.eN),t.LFG(b._W))};static#e=this.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var N=o(7411),_=o(2051),P=o(7012),m=o(8397),I=o(3574);function E(n,d){if(1&n){const e=t.EpF();t.TgZ(0,"div"),t._UZ(1,"div",1),t.TgZ(2,"div",2),t._uU(3),t.qZA(),t.TgZ(4,"div",3),t._uU(5),t.qZA(),t.TgZ(6,"div",4),t._uU(7),t.qZA(),t.TgZ(8,"div",2),t._uU(9),t.qZA(),t.TgZ(10,"div",4),t._uU(11),t.qZA(),t.TgZ(12,"div",4),t._uU(13),t.qZA(),t.TgZ(14,"button",5),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.editClicked())}),t.qZA(),t.TgZ(15,"button",6),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.callByPhone())}),t.qZA(),t.TgZ(16,"button",7),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.sendEmail())}),t.qZA(),t.TgZ(17,"button",8),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.deleteClicked())}),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(3),t.Oqu(e.hist.personName),t.xp6(2),t.Oqu(e.hist.categoryRef),t.xp6(2),t.Oqu(e.hist.source),t.xp6(2),t.Oqu(e.hist.email),t.xp6(2),t.Oqu(e.hist.phoneNo),t.xp6(2),t.Oqu(e.hist.status)}}let L=(()=>{class n{constructor(e){this.service=e,this.editEvent=new t.vpe,this.deleteEvent=new t.vpe}ngOnInit(){}editClicked(){this.service.getCallRecordWithItems(this.hist.id,this.hist.personType,this.hist.personId,this.hist.categoryRef).subscribe({next:e=>this.editEvent.emit(e)})}deleteClicked(){this.deleteEvent.emit(this.hist?.id)}callByPhone(){}sendEmail(){}static#t=this.\u0275fac=function(s){return new(s||n)(t.Y36(I.C))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["app-call-records-item"]],inputs:{hist:"hist"},outputs:{editEvent:"editEvent",deleteEvent:"deleteEvent"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"stdd","w75"],[1,"stdd","w175"],[1,"stdd","w150"],[1,"stdd","w100"],["title","click to add/edit transations",1,"btn","btn","fa","fa-pencil",3,"click"],["title","register conversation by phone",1,"btn","btn","fa","fa-phone",3,"click"],["title","advise conversation to the person by email",1,"btn","btn","fa","fa-envelope",3,"click"],["title","click to delete this record along with all its related child records",1,"btn","btn","fa","fa-trash","red",3,"click"]],template:function(s,i){1&s&&t.YNc(0,E,18,6,"div",0),2&s&&t.Q6J("ngIf",null!=i.hist)},dependencies:[c.O5],styles:[".stdd[_ngcontent-%COMP%]{display:inline-block;vertical-align:top;font-size:smaller;margin-left:1px;margin-right:1px;word-wrap:normal}.w50[_ngcontent-%COMP%]{width:50px}.w75[_ngcontent-%COMP%]{width:75px}.w100[_ngcontent-%COMP%]{width:100px}.w150[_ngcontent-%COMP%]{width:150px}.w175[_ngcontent-%COMP%]{width:175px}.red[_ngcontent-%COMP%]{color:red}"]})}return n})();const H=["search"];function S(n,d){if(1&n){const e=t.EpF();t.TgZ(0,"div",9)(1,"pagination",10),t.NdJ("pageChanged",function(i){t.CHM(e);const r=t.oxw();return t.KtG(r.onPageChanged(i))}),t._uU(2," >"),t.qZA(),t.TgZ(3,"input",11,12),t.NdJ("keyup.enter",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.onSearch())}),t.qZA(),t.TgZ(5,"button",13),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.onSearch())}),t.qZA(),t.TgZ(6,"button",14),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.onReset())}),t.qZA(),t._UZ(7,"button",15),t.qZA()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("totalItems",e.pagination.totalItems)("itemsPerPage",e.pagination.itemsPerPage)("maxSize",10)}}function k(n,d){1&n&&(t.TgZ(0,"div",16)(1,"h6"),t._uU(2,"No call records on record as per parameters given"),t.qZA()())}function J(n,d){if(1&n){const e=t.EpF();t.TgZ(0,"div")(1,"app-call-records-item",18),t.NdJ("editEvent",function(i){const l=t.CHM(e).$implicit,a=t.oxw(2);return t.KtG(a.editCallRecord(i,l))})("deleteEvent",function(i){t.CHM(e);const r=t.oxw(2);return t.KtG(r.deleteCallRecord(i))})("callRecordAddEvent",function(i){const l=t.CHM(e).$implicit,a=t.oxw(2);return t.KtG(a.addNewCallRecord(i,l))}),t.qZA()()}if(2&n){const e=d.$implicit;t.xp6(1),t.Q6J("hist",e)}}function q(n,d){if(1&n&&(t.TgZ(0,"div"),t.YNc(1,J,2,1,"div",17),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.callRecords)}}let y=(()=>{class n{constructor(e,s,i,r,l){this.service=e,this.confirm=s,this.toastr=i,this.bsModalRef=r,this.bsModalService=l,this.callRecords=[],this.oParams=new u,this.totalCount=0,this.contactResults=[],this.userHistoryParams=new u}ngOnInit(){this.getCallRecords(this.userHistoryParams),console.log("callRecords:",this.callRecords),this.contactResults=this.service.getContactResults()}getCallRecords(e){this.service.getUserHistoryPaged(e).subscribe({next:s=>{s.result&&s.pagination&&(this.callRecords=s.result,this.pagination=s.pagination,this.totalCount=s.count)}})}onPageChanged(e){const s=this.service.getParams()??new u;s.pageNumber!==e&&(s.pageNumber=e.page,this.service.setParams(s),this.getCallRecords(s))}deleteCallRecord(e){this.confirm.confirm("confirm delete this Order","confirm delete order").pipe((0,C.h)(i=>i),(0,v.w)(i=>this.service.deleteUserHistoryById(e).pipe((0,g.K)(r=>(console.log("Error in deleting the Call Record",r),(0,h.of)())),(0,w.b)(r=>this.toastr.success("deleted the Call Recorrd")))),(0,g.K)(i=>(this.toastr.error("Error in getting delete confirmation",i),(0,h.of)()))).subscribe(()=>{console.log("delete succeeded"),this.toastr.success("Call Record deleted")},i=>{console.log("any error NOT handed in catchError() or if throwError() is returned instead of of() inside catcherror()",i)})}addNewCallRecord(e,s){var i=e;null!=i?(i.personType=s.personType,this.bsModalRef=this.bsModalService.show(T.Y,{class:"modal-dialog-centered modal-md",initialState:{callRecord:i,phoneNo:s.phoneNo,email:s.email,status:"Not Started",candidateName:s.personName,categoryRef:s.categoryName,contactResults:this.contactResults}}),this.bsModalRef.content.callRecordAddEvent.pipe((0,C.h)(a=>a),(0,v.w)(a=>this.service.getOrAddCallRecord({personType:s.personType,subject:"",personId:s.personId,incomingOutgoing:a.incomingOutgoing,id:a.id,mobileNo:a.phoneNo,emailId:s.email,dateOfContact:a.dateOfContact,username:this.user?.userName,gistOfDiscussions:a.gistOfDiscussions,advisoryBy:a.advisoryBy,categoryRef:s.categoryRef,search:"",sort:"",status:a.contactResult,pageNumber:1,pageSize:10,statusClass:"",nextAction:"",nextActionOn:new Date}).pipe((0,g.K)(Q=>(0,h.of)())))).subscribe(()=>{this.toastr.success("Call Record Item added","success")},a=>this.toastr.error(a,"Error encountered"))):this.toastr.warning("No Call Record Item returned by modal form")}editCallRecord(e,s){null!==e?(this.bsModalRef=this.bsModalService.show(Z.h,{class:"modal-dialog-centered modal-lg",initialState:{callRecord:e,status:s.status,candidateName:s.personName,categoryRef:s.categoryName}}),this.bsModalRef.content.updateCallRecordEvent.subscribe({next:l=>{l?this.toastr.success("The Call Record was updated","success"):this.toastr.warning("Failed to update the call Record","Failed")},error:l=>this.toastr.error(l,"Error encountered")})):this.toastr.warning("No Call Record object returned by modal form")}onSearch(){const e=this.service.getParams();e.search=this.searchTerm?.nativeElement.value,e.pageNumber=1,this.service.setParams(e),this.getCallRecords(e)}onReset(){}static#t=this.\u0275fac=function(s){return new(s||n)(t.Y36(M),t.Y36(N.z),t.Y36(b._W),t.Y36(_.UZ),t.Y36(_.tT))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["app-call-records-list"]],viewQuery:function(s,i){if(1&s&&t.Gf(H,5),2&s){let r;t.iGM(r=t.CRH())&&(i.searchTerm=r.first)}},decls:20,vars:3,consts:[[2,"display","inline-block"],["style","display: inline-block; margin-left: 15px; vertical-align: top;",4,"ngIf"],[1,"form-inline",2,"margin-left","50px"],[1,"lbl","w75"],[1,"lbl","w175"],[1,"lbl","w150"],[1,"lbl","w100"],["class","my-2",4,"ngIf"],[4,"ngIf"],[2,"display","inline-block","margin-left","15px","vertical-align","top"],["previousText","\u2039","nextText","\u203a","firstText","\xab","lastText","\xbb",2,"display","inline-block",3,"totalItems","itemsPerPage","maxSize","pageChanged"],["type","text","placeholder","Search",1,"stdd","form-control","w300",3,"keyup.enter"],["search",""],["title","search the records based upon search string entered",1,"btn","btn-outline-primary","mx-1","fa","fa-search",3,"click"],["title","clears all search parameters",1,"btn","btn-outline-success","mx-1","fa","fa-refresh",3,"click"],["title","go back to Administration Menu","routerLink","/administration",1,"btn","btn-outline-success","form-inline","fa","fa-window-close"],[1,"my-2"],[4,"ngFor","ngForOf"],[3,"hist","editEvent","deleteEvent","callRecordAddEvent"]],template:function(s,i){1&s&&(t.TgZ(0,"h6",0),t._uU(1,"Call Records Listing"),t.qZA(),t.YNc(2,S,8,3,"div",1),t.TgZ(3,"div",2)(4,"label",3),t._uU(5,"App No"),t.qZA(),t.TgZ(6,"label",4),t._uU(7,"Name"),t.qZA(),t.TgZ(8,"label",5),t._uU(9,"CategoryRef"),t.qZA(),t.TgZ(10,"label",6),t._uU(11,"Source"),t.qZA(),t.TgZ(12,"label",4),t._uU(13,"Email"),t.qZA(),t.TgZ(14,"label",6),t._uU(15,"Phone No"),t.qZA(),t.TgZ(16,"label",6),t._uU(17,"Status"),t.qZA(),t.YNc(18,k,3,0,"div",7),t.YNc(19,q,2,1,"div",8),t.qZA()),2&s&&(t.xp6(2),t.Q6J("ngIf",void 0!==i.pagination),t.xp6(16),t.Q6J("ngIf",!i.callRecords||0===i.callRecords.length),t.xp6(1),t.Q6J("ngIf",i.callRecords))},dependencies:[c.sg,c.O5,P.Qt,m.rH,L],styles:[".lbl[_ngcontent-%COMP%]{display:inline-block;vertical-align:middle;font-weight:700;font-size:smaller;margin-left:1px;margin-right:1px;word-wrap:normal}.stdd[_ngcontent-%COMP%]{display:inline-block!important}.b[_ngcontent-%COMP%]{font-weight:700}.w50[_ngcontent-%COMP%]{width:50px}.w75[_ngcontent-%COMP%]{width:75px}.w100[_ngcontent-%COMP%]{width:100px}.w150[_ngcontent-%COMP%]{width:150px}.w175[_ngcontent-%COMP%]{width:175px}.w200[_ngcontent-%COMP%]{width:200px}.w300[_ngcontent-%COMP%]{width:300px}.red[_ngcontent-%COMP%]{color:red}"]})}return n})();var F=o(8180),B=o(7783);const G=[{path:"",component:(()=>{class n{constructor(e){this.accountService=e,this.hasAdminRole=!1,this.accountService.currentUser$.pipe((0,F.q)(1)).subscribe(s=>this.user=s),this.hasAdminRole=void 0!==this.user&&this.user.roles.includes("Admin")}static#t=this.\u0275fac=function(s){return new(s||n)(t.Y36(B.B))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["app-call-record-menu"]],decls:13,vars:2,consts:[[1,"container","d-flex","justify-contents-between","align-items-center","mt-5"],["routerLink","/callRecords/callRecordList","title","List of Pending Call Records - for admin role",3,"disabled"],["routerLink","/callRecords/callRecordListLoggedinUsername","title","Display active Call Records for logged in User"],["routerLink","/candidates/candidatehistory","title","Candidate history"]],template:function(s,i){1&s&&(t.TgZ(0,"div",0)(1,"button",1),t._uU(2,"Active Call Records"),t._UZ(3,"br"),t._uU(4,"of All users"),t.qZA(),t.TgZ(5,"button",2),t._uU(6,"Active Call Records"),t._UZ(7,"br"),t._uU(8),t.qZA(),t.TgZ(9,"button",3),t._uU(10,"Candidate History"),t.qZA(),t.TgZ(11,"button",3),t._uU(12,"Candidate History"),t.qZA()()),2&s&&(t.xp6(1),t.Q6J("disabled",!i.hasAdminRole),t.xp6(7),t.hij("Of ",i.user.knownAs,""))},dependencies:[m.rH]})}return n})()},{path:"callRecordList",component:y},{path:"callRecordListLoggedinUsername",component:y}];let D=(()=>{class n{static#t=this.\u0275fac=function(s){return new(s||n)};static#e=this.\u0275mod=t.oAB({type:n});static#s=this.\u0275inj=t.cJS({imports:[c.ez,m.Bz.forChild(G),m.Bz]})}return n})(),K=(()=>{class n{static#t=this.\u0275fac=function(s){return new(s||n)};static#e=this.\u0275mod=t.oAB({type:n});static#s=this.\u0275inj=t.cJS({imports:[c.ez,x.m,D]})}return n})()}}]);