"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[794],{7923:(T,_,o)=>{o.d(_,{x:()=>m});class m{constructor(){this.customerType="customer",this.customerCityName="",this.customerIndustryId=0,this.includeOfficials=!1,this.includeIndustries=!1,this.sort="name",this.pageNumber=1,this.pageSize=15,this.search=""}}},8892:(T,_,o)=>{o.d(_,{h:()=>R});var m=o(2771),b=o(7673),F=o(6354),y=o(3587),V=o(6220),I=o(7923),w=o(7705),k=o(1626);let R=(()=>{class g{constructor(l){this.http=l,this.apiUrl=y.c.apiUrl,this.currentUserSource=new m.m(1),this.currentUser$=this.currentUserSource.asObservable(),this.custParams=new I.x,this.customerType="",this.customersBrief=[],this.cache=new Map}getCustomerNameFromId(l){if(this.customersBrief.length>0){var t=this.customersBrief.find(u=>u.id===l);if(null!==t)return(0,b.of)(t?.knownAs)}return this.http.get(this.apiUrl+"customers/customernamefromId/"+l)}getCustomers(l){const t=this.cache.get(Object.values(l).join("-"));if(t)return(0,b.of)(t);this.customerType=l.customerType??"customer";let u=(0,V.di)(l);return(0,V.f8)(this.apiUrl+"customers",u,this.http).pipe((0,F.T)(x=>(this.cache.set(Object.values(l).join("-"),x),x)))}getCustomerList(l){return l=l??"Customer",console.log("getcustomerlist custType",l),this.http.get(this.apiUrl+"customers/list/"+l)}getClientIdAndNames(){return this.http.get(this.apiUrl+"customers/clientidandnames/customer")}getCustomer(l){return this.http.get(this.apiUrl+"customers/byid/"+l)}register(l){return this.http.post(this.apiUrl+"customers",l)}getCustomerCities(l){return this.http.get(this.apiUrl+"customers/customercities/"+l)}deleteCustomer(l){return this.http.delete(this.apiUrl+"Customers/customer/"+l)}deleteCustomerOfficial(l){return this.http.delete(this.apiUrl+"Customers/official/"+l)}setParams(l){this.custParams=l}getParams(){return this.custParams}updateCustomer(l){return this.http.put(this.apiUrl+"customers/edit",l)}getAgents(){return this.http.get(this.apiUrl+"customers/agentdetails/associate")}getOfficialAndCustomerName(){return this.http.get(this.apiUrl+"customers/officialidandcustomernames/customer")}getAgentIdAndNames(){return this.http.get(this.apiUrl+"customers/clientidandnames/associate")}getCustomerAndCities(){return this.http.get(this.apiUrl+"customers/customerCities/customer")}remindClientForSelections(l){return this.http.get(this.apiUrl+"CVRef/selDecisionReminder/"+l)}getFeedbackHistory(l){return this.http.get(this.apiUrl+"Feedback/history/"+l)}getOrCreateCustomerReview(l){return this.http.get(this.apiUrl+"CustomerReview/getOrCreateObject/"+l)}static#t=this.\u0275fac=function(t){return new(t||g)(w.KVO(k.Qq))};static#e=this.\u0275prov=w.jDH({token:g,factory:g.\u0275fac,providedIn:"root"})}return g})()},794:(T,_,o)=>{o.r(_),o.d(_,{VisaModule:()=>kt});var m=o(177),b=o(9485),F=o(9726),y=o(6697),V=o(9974),I=o(4360),w=o(5343),k=o(8750),g=o(5964),N=o(5558);class l{constructor(){this.id=0,this.visaItemId=0,this.visaNo="",this.customerId=0,this.customerName="",this.cvRefId=0,this.visaExpiryH="",this.visaExpiryG=new Date(1900,1,1),this.visaSponsorName="",this.visaCategory="",this.visaConsulate="",this.visaCanceled=!1,this.depItemId=0,this.visaApproved=!1,this.sort="visano",this.pageNumber=1,this.pageSize=15,this.search=""}}var t=o(7705),u=o(8256),x=o(779),P=o(1626),J=o(2771),j=o(7673),M=o(6354),z=o(3587),G=o(6220);let v=(()=>{class s{constructor(e){this.http=e,this.apiUrl=z.c.apiUrl,this.currentUserSource=new J.m(1),this.currentUser$=this.currentUserSource.asObservable(),this.vParams=new l,this.cache=new Map,this.cacheT=new Map}getPagedVisasBrief(e){const i=this.cache.get(Object.values(e).join("-"));if(i)return(0,j.of)(i);let n=U(e);return(0,G.f8)(this.apiUrl+"visas/PagedList",n,this.http).pipe((0,M.T)(r=>(this.cache.set(Object.values(e).join("-"),r),r)))}getPagedVisaTransactions(e){const i=this.cacheT.get(Object.values(e).join("-"));if(i)return(0,j.of)(i);let n=U(e);return(0,G.f8)(this.apiUrl+"visas/TransactionsPagedList",n,this.http).pipe((0,M.T)(r=>(this.cacheT.set(Object.values(e).join("-"),r),r)))}getVisaHeader(e){return this.http.get(this.apiUrl+"Visas/VisaHeader/"+e)}insertNewVisa(e){return this.http.post(this.apiUrl+"Visas/insertNewVisa",e)}updateVisa(e){return this.http.put(this.apiUrl+"Visas/editVisa",e)}insertNewVisaItem(e){return this.http.post(this.apiUrl+"Visas/insertNewVisaitem",e)}deleteVisaItem(e){return this.http.delete(this.apiUrl+"Visa/visaItem/"+e)}deleteVisa(e){return this.http.delete(this.apiUrl+"Visas/visa/"+e)}insertNewVisaTransaction(e){return this.http.post(this.apiUrl+"Visas/transaction",e)}editVisaTransaction(e){return this.http.put(this.apiUrl+"Visas/editTransaction",e)}deleteVisaTransaction(e){return this.http.delete(this.apiUrl+"Visas/ItemTransaction/"+e)}checkVisaExists(e){return this.http.get(this.apiUrl+"Visas/VisaNoExists/"+e)}getCustomerList(e){return this.http.get(this.apiUrl+"customers/list/"+(e=e??"Customer"))}getOpenVisasForCompany(e){return this.http.get(this.apiUrl+"visas/OpenVisaItemsForcustomerId/"+e)}getOrderItemsForCustomer(e){return this.http.get(this.apiUrl+"visas/OpenOrderItemsForCustomer/"+e)}assignVisaItemToOrderItem(e){return this.http.post(this.apiUrl+"visas/assignVisas",e)}setParams(e){this.vParams=e}getParams(){return this.vParams}static#t=this.\u0275fac=function(i){return new(i||s)(t.KVO(P.Qq))};static#e=this.\u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();function U(s){let a=new P.Nl;a=a.append("pageNumber",s.pageNumber),a=a.append("pageSize",s.pageSize);var e=new Date(s.visaExpiryG);return 0!==s.id&&(a=a.append("id",s.id.toString())),""!==s.visaNo&&(a=a.append("visaNo",s.visaNo)),0!==s.customerId&&(a=a.append("customerId",s.customerId.toString())),""!==s.customerName&&(a=a.append("customerName",s.customerName)),""!==s.visaExpiryH&&(a=a.append("visaExpiryH",s.visaExpiryH)),e.getFullYear()>2e3&&(a=a.append("visaExpiryG",e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate())),""!==s.visaSponsorName&&(a=a.append("visaSponsorName",s.visaSponsorName)),""!==s.visaCategory&&(a=a.append("visaCategory",s.visaCategory)),""!==s.visaConsulate&&(a=a.append("visaConsulate",s.visaConsulate)),!0===s.visaCanceled&&(a=a.append("visaCanceled",!0)),0!==s.depItemId&&(a=a.append("depItemId",s.depItemId.toString())),!0===s.visaApproved&&(a=a.append("visaApproved",!0)),a=a.append("sort",s.sort),a}var c=o(9417),C=o(9213);function H(s,a){if(1&s){const e=t.RV6();t.j41(0,"div")(1,"input",13),t.bIt("ngModelChange",function(n){const d=t.eBV(e).$implicit;return t.Njj(d.checked=n)}),t.k0s(),t.j41(2,"div",14),t.EFF(3),t.k0s(),t.j41(4,"div",15),t.EFF(5),t.k0s(),t.j41(6,"div",16),t.EFF(7),t.k0s(),t.j41(8,"div",16),t.EFF(9),t.k0s(),t.j41(10,"input",17),t.bIt("ngModelChange",function(n){const d=t.eBV(e).$implicit;return t.Njj(d.quantityAssigned=n)})("change",function(){const r=t.eBV(e).$implicit,d=t.XpG();return t.Njj(d.qntyChanged(r))}),t.k0s()()}if(2&s){const e=a.$implicit;t.R7$(1),t.Y8G("ngModel",e.checked),t.R7$(2),t.JRh(e.customerInBrief),t.R7$(2),t.JRh(e.category),t.R7$(2),t.JRh(e.quantity),t.R7$(2),t.JRh(e.unassigned),t.R7$(1),t.Y8G("ngModel",e.quantityAssigned)}}let A=(()=>{class s{constructor(e,i,n){this.toastr=e,this.bsModalRef=i,this.service=n,this.title="",this.orderItemsForTheCustomer=[],this.assignEvent=new t.bkB,this.visaAssignments=[],this.qntyAssigned=0}ngOnInit(){}qntyChanged(e){e.quantityAssigned>e.unassigned&&this.toastr.warning("Quantity assigned ("+this.qntyAssigned+") is more than visa avaialability ("+e.unassigned+")","Input error",{closeButton:!0,extendedTimeOut:0})}canceled(){this.qntyAssigned=0}close(){this.bsModalRef.hide()}update(){var e=this.orderItemsForTheCustomer.find(n=>!0===n.checked);this.orderItemsForTheCustomer.find(n=>n.orderItemId!==e?.orderItemId),this.visaAssignments.push({orderItemId:e.orderItemId,visaItemId:this.visaItem.id,visaQntyAssigned:e.quantityAssigned,dateAssigned:new Date}),this.assignEvent.emit(this.visaAssignments),this.bsModalRef.hide()}static#t=this.\u0275fac=function(i){return new(i||s)(t.rXU(u.tw),t.rXU(x.Y$),t.rXU(v))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["app-visa-assign-modal"]],inputs:{title:"title",visaItem:"visaItem",orderItemsForTheCustomer:"orderItemsForTheCustomer"},outputs:{assignEvent:"assignEvent"},decls:31,vars:9,consts:[[1,"my-0","modal-header"],[1,"b"],[1,"modal-body"],[1,"my-0","b",2,"display","inline-block"],[1,"my-0"],[1,"my-0",2,"display","inline-block"],[1,"icon",2,"vertical-align","top","display","inline-block",3,"click"],[1,"stdd","w125","b","fontStretched",2,"margin-left","15px"],[1,"stdd","w175","b","fontStretched"],[1,"stdd","w50","b"],["title","enter number of visas to assign now",1,"stdd","w50","b"],[4,"ngFor","ngForOf"],[1,"modal-footer"],["type","checkbox",1,"form-check-input","w20","hAlignCenter",2,"border-color","black",3,"ngModel","ngModelChange"],[1,"stdd","w125","fSizeSmaller"],[1,"stdd","w150","fSizeSmaller"],[1,"stdd","w50","hAlignRight"],["type","text",1,"stdd","w40","hAlignRight",2,"margin-left","25px !important",3,"ngModel","ngModelChange","change"]],template:function(i,n){1&i&&(t.j41(0,"div",0)(1,"h4",1),t.EFF(2),t.k0s()(),t.j41(3,"div",2)(4,"h2",3),t.EFF(5),t.k0s(),t.nrm(6,"br",4),t.j41(7,"h3",5),t.EFF(8),t.nI1(9,"date"),t.j41(10,"strong"),t.EFF(11),t.k0s()(),t.j41(12,"button",6),t.bIt("click",function(){return n.close()}),t.j41(13,"mat-icon"),t.EFF(14,"cancel"),t.k0s()(),t.j41(15,"button",6),t.bIt("click",function(){return n.update()}),t.j41(16,"mat-icon"),t.EFF(17,"save"),t.k0s()(),t.nrm(18,"br"),t.j41(19,"label",7),t.EFF(20,"Customer"),t.k0s(),t.j41(21,"label",8),t.EFF(22,"Category"),t.k0s(),t.j41(23,"label",9),t.EFF(24,"Visa Qnty"),t.k0s(),t.j41(25,"label",9),t.EFF(26,"Visa Bal"),t.k0s(),t.j41(27,"label",10),t.EFF(28,"new assign"),t.k0s(),t.DNE(29,H,11,6,"div",11),t.k0s(),t.nrm(30,"div",12)),2&i&&(t.R7$(2),t.JRh(n.title),t.R7$(3),t.JRh(n.visaItem.customerKnownAs),t.R7$(3),t.Lme("Visa No.: ",n.visaItem.visaNo," dt ",t.i5U(9,6,n.visaItem.visaDateG,"dd-MMM-yy"),". Category "),t.R7$(3),t.JRh(n.visaItem.visaCategoryEnglish),t.R7$(18),t.Y8G("ngForOf",n.orderItemsForTheCustomer))},dependencies:[m.Sq,c.me,c.Zm,c.BC,c.vS,C.An,m.vh],styles:[".stdd[_ngcontent-%COMP%]{display:inline-block;font-size:smaller;vertical-align:top;margin:0 2px}.margin2[_ngcontent-%COMP%]{margin:0 2px}.b[_ngcontent-%COMP%]{font-weight:700}.w15[_ngcontent-%COMP%]{width:15px}.w40[_ngcontent-%COMP%]{width:40px}.w50[_ngcontent-%COMP%]{width:50px}.w80[_ngcontent-%COMP%]{width:80px}.w100[_ngcontent-%COMP%]{width:100px}.w125[_ngcontent-%COMP%]{width:125px}.w150[_ngcontent-%COMP%]{width:150px}.w175[_ngcontent-%COMP%]{width:175px}.fontStretched[_ngcontent-%COMP%]{font-stretch:condensed}.hAlignRight[_ngcontent-%COMP%]{text-align:right}.hAlignCentre[_ngcontent-%COMP%]{text-align:center}.btn[_ngcontent-%COMP%]{color:#f0f8ff;margin:0 2px;width:20px;vertical-align:middle}.icon[_ngcontent-%COMP%]{margin:0 20px;height:12px;width:12px;font-size:12px;display:inline-block;vertical-align:top}"]})}return s})();var D=o(1822),p=o(5743),$=o(778),B=o(3400),S=o(2510);let K=(()=>{class s{constructor(e){this.accountService=e,localStorage.getItem("user"),this.user||this.accountService.currentUser$.pipe((0,M.T)(i=>{i&&(this.user=i)}))}setItem(e,i){localStorage.setItem(e,i)}loggedInUserhasVisaEditRole(){return!!this.user&&this.user.roles.includes("visaEdit")}getLoggedInUserRoles(){return this.user?this.user.roles:[]}getLoggedInUserEmploer(){return this.user?.employer??""}removeItem(e){localStorage.removeItem(e)}clear(){localStorage.clear()}static#t=this.\u0275fac=function(i){return new(i||s)(t.KVO(D.D))};static#e=this.\u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();function W(s,a){if(1&s){const e=t.RV6();t.j41(0,"div",9)(1,"button",10),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.editEventClicked())}),t.j41(2,"mat-icon"),t.EFF(3,"edit"),t.k0s()(),t.j41(4,"button",11),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.assignEventClicked())}),t.j41(5,"mat-icon"),t.EFF(6,"list"),t.k0s()(),t.j41(7,"button",12),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.deleteEventClicked())}),t.j41(8,"mat-icon"),t.EFF(9,"delete"),t.k0s()()()}}function Z(s,a){if(1&s){const e=t.RV6();t.j41(0,"div")(1,"div",1),t.EFF(2),t.k0s(),t.j41(3,"div",2),t.EFF(4),t.k0s(),t.j41(5,"div",3),t.EFF(6),t.k0s(),t.j41(7,"div",3),t.EFF(8),t.k0s(),t.j41(9,"div",2),t.EFF(10),t.nI1(11,"date"),t.k0s(),t.j41(12,"div",4),t.EFF(13),t.k0s(),t.j41(14,"div",5),t.EFF(15),t.k0s(),t.j41(16,"div",6),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.visaConsumedClicked())}),t.EFF(17),t.k0s(),t.j41(18,"div",5),t.EFF(19),t.k0s(),t.j41(20,"div",7),t.EFF(21),t.k0s(),t.DNE(22,W,10,0,"div",8),t.k0s()}if(2&s){const e=t.XpG();t.R7$(2),t.JRh(e.visa.customerKnownAs),t.R7$(2),t.JRh(e.visa.visaConsulate),t.R7$(2),t.JRh(e.visa.visaSponsorName),t.R7$(2),t.JRh(e.visa.visaNo),t.R7$(2),t.JRh(t.i5U(11,11,e.visa.visaDateG,"dd-MMM-yy")),t.R7$(3),t.JRh(e.visa.visaCategoryEnglish),t.R7$(2),t.JRh(e.visa.visaQuantity),t.R7$(2),t.JRh(e.visa.visaConsumed),t.R7$(2),t.JRh(e.visa.visaQuantity-e.visa.visaConsumed),t.R7$(2),t.JRh(e.visa.visaCanceled?"Y":"N"),t.R7$(1),t.Y8G("ngIf",!e.isReport)}}let q=(()=>{class s{constructor(e,i,n){this.service=e,this.toastr=i,this.localStorageService=n,this.isReport=!1,this.editEvent=new t.bkB,this.deleteEvent=new t.bkB,this.assignEvent=new t.bkB,this.consumedEvent=new t.bkB,this.displayAssignRole=!1,this.loggedInUserHasVisaEditCredential=!1,this.loggedInUserHasVisaEditCredential=n.loggedInUserhasVisaEditRole()}ngOnInit(){}editEventClicked(){this.editEvent.emit(this.visa?.id)}deleteEventClicked(){this.deleteEvent.emit(this.visa?.id)}visaConsumedClicked(){this.consumedEvent.emit(this.visa?.id)}assignEventClicked(){this.assignEvent.emit(this.visa)}getOpenVisasForVisaCompany(){}static#t=this.\u0275fac=function(i){return new(i||s)(t.rXU(v),t.rXU(u.tw),t.rXU(K))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["app-visa-line"]],inputs:{visa:"visa",isReport:"isReport"},outputs:{editEvent:"editEvent",deleteEvent:"deleteEvent",assignEvent:"assignEvent",consumedEvent:"consumedEvent"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"stdd","w125",2,"margin-left","15px"],[1,"stdd","w80"],[1,"stdd","w100"],[1,"stdd","w125"],[1,"stdd","w50","hAlignRight"],[1,"stdd","w50","hAlignRight","cursorPointer",3,"click"],[1,"stdd","w50","hAlignCenter"],["class","stdd",4,"ngIf"],[1,"stdd"],["title","edit visa item",1,"btn","icon",3,"click"],["title","assign visas to Demand Letter categories",1,"btn","icon",3,"click"],[1,"btn","icon","red",3,"click"]],template:function(i,n){1&i&&t.DNE(0,Z,23,14,"div",0),2&i&&t.Y8G("ngIf",n.visa)},dependencies:[m.bT,C.An,m.vh],styles:[".stdd[_ngcontent-%COMP%]{display:inline-block;word-wrap:break-word;font-size:small;margin:0 2px 0 8px;vertical-align:top}.hAlignRight[_ngcontent-%COMP%]{text-align:right}.hAlignCenter[_ngcontent-%COMP%]{text-align:center}.red[_ngcontent-%COMP%]{color:red}.w15[_ngcontent-%COMP%]{width:15px}.w20[_ngcontent-%COMP%]{width:20px}.w50[_ngcontent-%COMP%]{width:50px}.w80[_ngcontent-%COMP%]{width:80px}.w100[_ngcontent-%COMP%]{width:100px}.w125[_ngcontent-%COMP%]{width:125px}.w150[_ngcontent-%COMP%]{width:150px}.fSizeSmaller[_ngcontent-%COMP%]{font-size:smaller;font-stretch:condensed;color:#ff69b4}.btn[_ngcontent-%COMP%]{color:#f0f8ff;margin:0 2px;width:20px;vertical-align:top;display:inline-block}.icon[_ngcontent-%COMP%]{height:12px;width:12px;font-size:12px}.cursorPointer[_ngcontent-%COMP%]{cursor:pointer;color:#ff0}"]})}return s})();const tt=["search"];function et(s,a){if(1&s){const e=t.RV6();t.j41(0,"pagination",21),t.bIt("pageChanged",function(n){t.eBV(e);const r=t.XpG(2);return t.Njj(r.onPageChanged(n))}),t.EFF(1," >"),t.k0s()}if(2&s){const e=t.XpG(2);t.Y8G("totalItems",e.pagination.totalItems)("itemsPerPage",e.pagination.itemsPerPage)("maxSize",15)}}function it(s,a){1&s&&(t.j41(0,"div",22),t.EFF(1," No Visas on record matching your criteria "),t.k0s())}function st(s,a){if(1&s){const e=t.RV6();t.j41(0,"div",24)(1,"app-visa-line",25),t.bIt("deleteEvent",function(){const r=t.eBV(e).$implicit,d=t.XpG(3);return t.Njj(d.deleteVisa(r.id))})("editEvent",function(){const r=t.eBV(e).$implicit,d=t.XpG(3);return t.Njj(d.editVisa(r.id))})("assignEvent",function(n){t.eBV(e);const r=t.XpG(3);return t.Njj(r.DisplayOrderItemsOfCustomer(n))})("consumedEvent",function(n){t.eBV(e);const r=t.XpG(3);return t.Njj(r.displayVisaConsumed(n))}),t.k0s()()}if(2&s){const e=a.$implicit;t.R7$(1),t.Y8G("isReport",!1)("visa",e)}}function nt(s,a){if(1&s&&(t.j41(0,"div"),t.DNE(1,st,2,2,"div",23),t.k0s()),2&s){const e=t.XpG(2);t.R7$(1),t.Y8G("ngForOf",e.visas)}}function at(s,a){if(1&s){const e=t.RV6();t.j41(0,"div")(1,"div"),t.EFF(2),t.k0s(),t.j41(3,"div"),t.EFF(4),t.k0s(),t.j41(5,"div"),t.EFF(6),t.k0s(),t.j41(7,"button",26),t.bIt("click",function(){const r=t.eBV(e).$implicit,d=t.XpG(2);return t.Njj(d.deleteAssignment(r))}),t.k0s()()}if(2&s){const e=a.$implicit;t.R7$(2),t.JRh(e.visaItemId),t.R7$(2),t.JRh(e.orderItemId),t.R7$(2),t.JRh(e.visaQntyAssigned)}}function rt(s,a){if(1&s){const e=t.RV6();t.j41(0,"div")(1,"h4",3),t.EFF(2,"Visa Listing"),t.k0s(),t.j41(3,"div",4),t.DNE(4,et,2,3,"pagination",5),t.j41(5,"label",6),t.EFF(6,"Choose Customer to generate report"),t.k0s(),t.j41(7,"ng-select",7),t.bIt("ngModelChange",function(n){t.eBV(e);const r=t.XpG();return t.Njj(r.visaCustomerSelected=n)}),t.k0s(),t.j41(8,"button",8),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.generatePDF())}),t.j41(9,"mat-icon"),t.EFF(10,"print"),t.k0s()(),t.j41(11,"button",9)(12,"mat-icon"),t.EFF(13,"library_add"),t.k0s()(),t.j41(14,"button",10),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.saveAssignments())}),t.j41(15,"mat-icon"),t.EFF(16,"save"),t.k0s()(),t.j41(17,"button",11)(18,"mat-icon"),t.EFF(19,"cancel"),t.k0s()()(),t.nrm(20,"br"),t.j41(21,"div",12)(22,"label",13),t.EFF(23,"Customer"),t.k0s(),t.j41(24,"label",14),t.EFF(25,"Consulate"),t.k0s(),t.j41(26,"label",15),t.EFF(27,"Sponsor Name"),t.k0s(),t.j41(28,"label",15),t.EFF(29,"Visa No."),t.k0s(),t.j41(30,"label",14),t.EFF(31,"Visa Date"),t.k0s(),t.j41(32,"label",16),t.EFF(33,"Visa Category"),t.k0s(),t.j41(34,"label",17),t.EFF(35,"Quantity"),t.k0s(),t.j41(36,"label",17),t.EFF(37,"Con-"),t.nrm(38,"br"),t.EFF(39,"sumed"),t.k0s(),t.j41(40,"label",17),t.EFF(41,"Visa"),t.nrm(42,"br"),t.EFF(43,"Balance"),t.k0s(),t.j41(44,"label",17),t.EFF(45,"Visa Canceled"),t.k0s()(),t.nrm(46,"hr",18),t.DNE(47,it,2,0,"div",19),t.DNE(48,nt,2,1,"div",0),t.DNE(49,at,8,3,"div",20),t.k0s()}if(2&s){const e=t.XpG();t.R7$(4),t.Y8G("ngIf",void 0!==e.pagination),t.R7$(3),t.Y8G("items",e.visaCustomers)("ngModel",e.visaCustomerSelected),t.R7$(1),t.Y8G("previewOnly",!1)("useExistingCss",!0)("disabled",""===e.visaCustomerSelected),t.R7$(6),t.Y8G("disabled",0===e.assignments.length),t.R7$(33),t.Y8G("ngIf",!e.visas),t.R7$(1),t.Y8G("ngIf",e.visas.length),t.R7$(1),t.Y8G("ngForOf",e.assignments)}}function ot(s,a){if(1&s&&(t.j41(0,"div"),t.nrm(1,"app-visa-line",27),t.k0s()),2&s){const e=a.$implicit;t.R7$(1),t.Y8G("isReport",!0)("visa",e)}}function lt(s,a){if(1&s&&(t.j41(0,"div"),t.DNE(1,ot,2,2,"div",20),t.k0s()),2&s){const e=t.XpG();t.R7$(1),t.Y8G("ngForOf",e.visas)}}let ct=(()=>{class s{constructor(e,i,n,r,d,f,E){this.service=e,this.accountsService=i,this.activatedRoute=n,this.toastr=r,this.modalService=d,this.confirm=f,this.router=E,this.orderItemsForTheCustomer=[],this.visas=[],this.totalCount=0,this.totalBal=0,this.vParams=new l,this.isReportActive=!1,this.printVisas=[],this.isPrintPDF=!1,this.printtitle="",this.visaCustomers=[],this.visaCustomerSelected="",this.assignments=[],this.accountsService.currentUser$.pipe((0,y.s)(1)).subscribe(h=>this.user=h)}ngOnInit(){this.activatedRoute.data.subscribe(e=>{this.visas=e.visas.result,this.pagination=e.visas.pagination,this.totalCount=e.visas.totalCount}),this.visaCustomers=this.visas.map(e=>e.customerKnownAs),function R(s,a){(0,V.N)((e,i)=>{const n=new Set;e.subscribe((0,I._)(i,r=>{const d=s?s(r):r;n.has(d)||(n.add(d),i.next(r))})),a&&(0,k.Tg)(a).subscribe((0,I._)(i,()=>n.clear(),w.l))})}(),this.totalBal=+this.visas.map(e=>e.visaBalance).reduce((e,i)=>+e+ +i,0)}loadVisas(){var e=this.service.getParams();this.service.getPagedVisasBrief(e)?.subscribe({next:i=>{null!=i?(this.visas=i.result,this.totalCount=i?.count,this.pagination=i.pagination):console.log("response is undefined")},error:i=>console.log(i.error?.details,"Error encountered")})}onPageChanged(e){const i=this.service.getParams();i.pageNumber!==e&&(i.pageNumber=e.page,this.service.setParams(i),this.loadVisas())}deleteVisa(e){var i=e;const r=this.service.deleteVisa(i);this.confirm.confirm("confirm Delete","confirm delete this Visa?. WARNING: this cannot be undone").pipe((0,g.p)(f=>f),(0,N.n)(f=>r)).subscribe(f=>{if(f){this.toastr.success("Visa deleted","deletion successful");var E=this.visas.findIndex(h=>h.id==i);E>=0&&this.visas.splice(E,1)}else this.toastr.error("Error in deleting the Visa","failed to delete")})}editVisa(e){null!==e?this.router.navigateByUrl("/visas/visaEdit/"+e):this.toastr.warning("No Visa Id available")}generatePDF(){this.printtitle="Visas for "+this.visaCustomerSelected,this.printVisas=this.visas.filter(e=>e.customerKnownAs===this.visaCustomerSelected),this.printVisas.length&&(this.isPrintPDF=!0)}saveAssignments(){this.service.assignVisaItemToOrderItem(this.assignments).subscribe({next:e=>{e.length>0?this.toastr.success("visa assignments updated"):this.toastr.warning("failed to update the visa assignments")},error:e=>this.toastr.error(e.error?.details,"Error")})}deleteAssignment(e){}getOrderItemsForCustomer(e){this.bsModalRef=this.modalService.show(A,{class:"modal-dialog-centered",initialState:{title:"Assign Visas to Order Categories",visaItem:e}}),this.bsModalRef.content.assignEvent.subscribe(n=>{n.length>0&&this.service.assignVisaItemToOrderItem(n).subscribe(()=>{})})}DisplayOrderItemsOfCustomer(e){this.service.getOrderItemsForCustomer(e.customerId).pipe((0,g.p)(n=>n.length>0),(0,N.n)(n=>(console.log("order items in outer loop",n),this.bsModalRef=this.modalService.show(A,{class:"modal-dialog-centered modal-lg",initialState:{title:"Assign Visas to Order Categories",visaItem:e,orderItemsForTheCustomer:n}}),this.bsModalRef.content.assignEvent))).subscribe(n=>{n?(n&&this.service.assignVisaItemToOrderItem(n).subscribe({next:r=>this.toastr.success("Visa assigned to ")}),this.toastr.success("Viewed/updated the Custom Assessment Parameters for the category","Success")):this.toastr.warning("Failed to view/update the Custom Assessment Parameters","Failed")})}displayVisaConsumed(e){this.navigateByRoute(e,"/visas/visaTransactions")}navigateByRoute(e,i){this.router.navigate([0===e?i:i+"/"+e],{state:{user:this.user,returnUrl:"/visas"}})}static#t=this.\u0275fac=function(i){return new(i||s)(t.rXU(v),t.rXU(D.D),t.rXU(p.nX),t.rXU(u.tw),t.rXU(x.I8),t.rXU($.G),t.rXU(p.Ix))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["app-visalist"]],viewQuery:function(i,n){if(1&i&&t.GBs(tt,5),2&i){let r;t.mGM(r=t.lsd())&&(n.searchTerm=r.first)}},decls:6,vars:3,consts:[[4,"ngIf"],[2,"margin-left","750px","font-weight","bold","display","inline-block"],[1,"b","alignR","w35","mx-2",2,"display","inline-block"],[2,"display","inline-block","font-weight","bold"],[2,"display","inline-block","margin-left","15px","vertical-align","top"],["class","mx-2","style","display: inline-block;","previousText","\u2039","nextText","\u203a","firstText","\xab","lastText","\xbb",3,"totalItems","itemsPerPage","maxSize","pageChanged",4,"ngIf"],["title","The paged list that will retreive records based upon the customer you select",1,"lbl","w200","mx-2",2,"display","inline-block"],["bindLabel","customer","bindValue","customer","labelForId","customer","clearAllText","Clear",1,"stdd",2,"border-style","double","width","200px","font-size","small","display","inline-block",3,"items","ngModel","ngModelChange"],["printSectionId","print-section","printTitle","printTitle","ngxPrint","","title","shows the report in pdf format and enables printing","title","print pdf for current category Ref",2,"display","inline-block","margin-left","50px",3,"previewOnly","useExistingCss","disabled","click"],["title","Add new Visa","routerLink","/visas/visaEdit/0",1,"btn","mx-5"],["title","Save the assignments",1,"btn","mx-5",3,"disabled","click"],["title","Exit this page","routerLink","/",1,"btn"],[1,"form-inline"],[1,"lbl","w125",2,"margin-left","15px"],[1,"lbl","w80"],[1,"lbl","w100"],[1,"lbl","w125"],[1,"lbl","w50"],[1,"my-0"],["class","my-2",4,"ngIf"],[4,"ngFor","ngForOf"],["previousText","\u2039","nextText","\u203a","firstText","\xab","lastText","\xbb",1,"mx-2",2,"display","inline-block",3,"totalItems","itemsPerPage","maxSize","pageChanged"],[1,"my-2"],["class","row",4,"ngFor","ngForOf"],[1,"row"],[3,"isReport","visa","deleteEvent","editEvent","assignEvent","consumedEvent"],[1,"btn",3,"click"],[3,"isReport","visa"]],template:function(i,n){1&i&&(t.DNE(0,rt,50,10,"div",0),t.j41(1,"div",1),t.EFF(2,"Total Balance:"),t.k0s(),t.j41(3,"span",2),t.EFF(4),t.k0s(),t.DNE(5,lt,2,1,"div",0)),2&i&&(t.Y8G("ngIf",!n.isPrintPDF),t.R7$(4),t.JRh(n.totalBal),t.R7$(1),t.Y8G("ngIf",n.isPrintPDF))},dependencies:[m.Sq,m.bT,B.eK,c.BC,c.vS,S.vr,F.GV,p.Wk,C.An,q],styles:[".lbl[_ngcontent-%COMP%]{font-size:smaller;font-weight:700;margin:0 2px 0 8px;vertical-align:middle}.stdd[_ngcontent-%COMP%]{font-size:smaller;margin:0 2px;vertical-align:top}.w35[_ngcontent-%COMP%]{width:35px}.w50[_ngcontent-%COMP%]{width:50px}.w80[_ngcontent-%COMP%]{width:80px}.w100[_ngcontent-%COMP%]{width:100px}.w125[_ngcontent-%COMP%]{width:125px}.w150[_ngcontent-%COMP%]{width:150px}.w200[_ngcontent-%COMP%]{width:200px}.b[_ngcontent-%COMP%]{font-weight:700}.alignR[_ngcontent-%COMP%]{text-align:right}.btn[_ngcontent-%COMP%]{color:#f0f8ff;margin:0 2px;size:20px;vertical-align:middle}"]})}return s})();class X{constructor(){this.id=0,this.visaNo="",this.customerId=0,this.customerName="",this.visaDateG=new Date,this.visaDateH="",this.visaExpiryH="",this.visaExpiryG=new Date,this.visaSponsorName="",this.visaItems=[]}}var Y=o(9375),mt=o(6295);function pt(s,a){if(1&s){const e=t.RV6();t.j41(0,"div")(1,"div",2),t.EFF(2),t.k0s(),t.j41(3,"button",3),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.updateVisa())}),t.j41(4,"mat-icon"),t.EFF(5,"save"),t.k0s()(),t.j41(6,"button",4)(7,"mat-icon"),t.EFF(8,"cancel"),t.k0s()()()}if(2&s){const e=t.XpG();t.R7$(2),t.JRh(0===e.visa.id?"Create new Visa":"Edit Visa")}}function ht(s,a){1&s&&(t.j41(0,"div",33),t.EFF(1," Visa Quantity not entered "),t.k0s())}function ut(s,a){1&s&&(t.j41(0,"div",33),t.EFF(1," Visa Quantity should be between 1 and 250 "),t.k0s())}function vt(s,a){if(1&s){const e=t.RV6();t.j41(0,"div")(1,"div",25),t.nrm(2,"app-text-input",26)(3,"app-text-input",27)(4,"app-text-input",28)(5,"app-text-input",29),t.j41(6,"input",30),t.bIt("change",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.recalculateCount())}),t.k0s(),t.DNE(7,ht,2,0,"div",31),t.DNE(8,ut,2,0,"div",31),t.j41(9,"button",32),t.bIt("click",function(){const r=t.eBV(e).index,d=t.XpG(2);return t.Njj(d.removeVisaItem(r))}),t.j41(10,"mat-icon"),t.EFF(11,"delete"),t.k0s()()()()}if(2&s){const e=a.index,i=t.XpG(2);t.R7$(1),t.Y8G("formGroupName",e),t.R7$(1),t.Y8G("label","Sr#"),t.R7$(1),t.Y8G("label","Category Name"),t.R7$(1),t.Y8G("label","Cat in Arabic"),t.R7$(1),t.Y8G("label","Consulate"),t.R7$(2),t.Y8G("ngIf",(null==i.form.controls.visaQuantity?null:i.form.controls.visaQuantity.touched)&&(null==i.form.controls.visaQuantity?null:i.form.controls.visaQuantity.invalid)&&i.form.controls.visaQuantity.errors&&i.form.controls.visaQuantity.errors.required),t.R7$(1),t.Y8G("ngIf",(null==i.form.controls.visaQuantity?null:i.form.controls.visaQuantity.touched)&&(null==i.form.controls.visaQuantity?null:i.form.controls.visaQuantity.invalid)&&i.form.controls.visaQuantity.errors&&(i.form.controls.visaQuantity.errors.min||i.form.controls.visaQuantity.errors.max))}}const L=function(){return{dateInputFormat:"YYYY-MM-DD"}};function gt(s,a){if(1&s){const e=t.RV6();t.j41(0,"div",5)(1,"form",6)(2,"label",7),t.EFF(3,"Customer:"),t.k0s(),t.j41(4,"div",8),t.nrm(5,"ng-select",9),t.k0s(),t.j41(6,"label",10),t.EFF(7,"Visa Sponsor:"),t.k0s(),t.nrm(8,"app-text-input",11)(9,"br"),t.j41(10,"label",7),t.EFF(11,"Visa No:"),t.k0s(),t.nrm(12,"app-text-input",12)(13,"input",13)(14,"input",14)(15,"hr",15),t.j41(16,"label",16),t.EFF(17,"Sr#"),t.k0s(),t.j41(18,"label",17),t.EFF(19,"Visa Category-English"),t.k0s(),t.j41(20,"label",18),t.EFF(21,"in Arabic"),t.k0s(),t.j41(22,"label",19),t.EFF(23,"Consulate"),t.k0s(),t.j41(24,"label",16),t.EFF(25,"Qnty"),t.k0s(),t.j41(26,"button",20),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.addVisaItem())}),t.j41(27,"mat-icon"),t.EFF(28,"library_add"),t.k0s()(),t.j41(29,"div",21),t.DNE(30,vt,12,7,"div",22),t.j41(31,"div",23),t.EFF(32,"total: "),t.k0s(),t.j41(33,"div",24),t.EFF(34),t.k0s()()()()}if(2&s){const e=t.XpG();t.R7$(1),t.Y8G("formGroup",e.form),t.R7$(4),t.Y8G("items",e.customers),t.R7$(3),t.Y8G("label","Sponsor Name"),t.R7$(4),t.Y8G("label","Visa No"),t.R7$(1),t.Y8G("bsValue",e.bsValueDate)("bsConfig",t.lJ4(10,L)),t.R7$(1),t.Y8G("bsValue",e.bsValueDate)("bsConfig",t.lJ4(11,L)),t.R7$(16),t.Y8G("ngForOf",e.visaItems.controls),t.R7$(4),t.JRh(e.totalCount)}}let ft=(()=>{class s{constructor(e,i,n,r,d,f){this.toastr=e,this.service=i,this.activatedRoute=n,this.fb=r,this.confirm=d,this.router=f,this.customers=[],this.bsValueDate=new Date,this.bsValue=new Date,this.returnUrl="",this.totalCount=0,this.visaIdFromRouter="",this.form=new c.gE({}),this.errors=[],n.snapshot.paramMap.get("visaid");let h=this.router.getCurrentNavigation();h?.extras&&h.extras.state&&(h.extras.state.returnUrl&&(this.returnUrl=h.extras.state.returnUrl),h.extras.state.user&&(this.user=h.extras.state.user))}ngOnInit(){this.service.getCustomerList("Customer").subscribe({next:e=>this.customers=e}),""==this.visaIdFromRouter||"0"===this.visaIdFromRouter?this.visa=new X:this.service.getVisaHeader(+this.visaIdFromRouter).subscribe({next:e=>this.visa=e}),this.visa||(this.visa=new X),this.InitializeForm(this.visa)}InitializeForm(e){this.form=this.fb.group({id:e.id??0,customerId:e.customerId??0,customerName:[e.customerName??""],visaNo:"",visaSponsorName:"",visaDateG:["",c.k0.required],visaExpiryG:["",c.k0.required],visaItems:this.fb.array(e.visaItems.map(i=>this.fb.group({id:i.id??0,srNo:i.srNo??1,visaCategoryEnglish:[i.visaCategoryEnglish??"",[c.k0.required,c.k0.minLength(5),c.k0.maxLength(250)]],visaCategoryArabic:"",visaConsulate:[i.visaConsulate,[c.k0.required,c.k0.maxLength(15)]],visaQuantity:[i.visaQuantity??0,[c.k0.min(1),c.k0.max(250)]]})))})}get visaItems(){return this.form.get("visaItems")}newVisaItem(){var e=0===this.visaItems.length?1:Math.max(...this.visaItems.value.map(i=>i.srNo))+1;return this.fb.group({id:0,srNo:e,visaCategoryEnglish:["",[c.k0.required,c.k0.minLength(5),c.k0.maxLength(250)]],visaCategoryArabic:"",visaConsulate:["",c.k0.required],visaNo:"",visaQuantity:[0,[c.k0.min(1),c.k0.max(250)]]})}addVisaItem(){this.visaItems.length&&(this.form.get("visaNameEnglish")?.invalid||this.form.get("visaQuantity")?.invalid)?this.toastr.warning("This form is dirty - ensrue visa name and visa quantity is properly filled in before attemtpign to add another visa item","form not properly filled in",{closeButton:!0,extendedTimeOut:0}):this.visaItems.push(this.newVisaItem())}removeVisaItem(e){this.visaItems.removeAt(e)}updateVisa(){if(this.errors.length>0)this.toastr.error("this form has errors.  Fix the errors before attempting to save the form","Form is dirty",{closeButton:!0,extendedTimeOut:0});else{var e=this.form.value;0===e.id?this.service.insertNewVisa(e).subscribe({next:i=>{null===i?this.toastr.warning("Failed to insert the Visa","Failure"):this.toastr.success("Vias inserted","Success")},error:i=>this.toastr.error(i.error?.details,"Error")}):this.service.updateVisa(e).subscribe({next:i=>{null===i?this.toastr.warning("Failed to save the Visa","Failure"):this.toastr.success("Vias saved","Success")},error:i=>this.toastr.error(i.error?.details,"Error")})}}recalculateCount(){return this.totalCount=+this.visaItems.value.map(e=>e.visaQuantity).reduce((e,i)=>+e+ +i,0),this.totalCount}static#t=this.\u0275fac=function(i){return new(i||s)(t.rXU(u.tw),t.rXU(v),t.rXU(p.nX),t.rXU(c.ok),t.rXU($.G),t.rXU(p.Ix))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["app-register-new"]],decls:2,vars:2,consts:[[4,"ngIf"],["class","container",4,"ngIf"],[2,"margin-left","15px","font-size","large","font-weight","bold","display","inline-block"],[1,"btn",2,"margin-left","200px",3,"click"],["routerLink","/visas",1,"btn"],[1,"container"],[3,"formGroup"],[1,"lbl","w100"],[1,"stdd","w250","mx-2"],["bindLabel","customerName","bindValue","id","labelForId","id","clearAllText","Clear","formControlName","customerId",3,"items"],[1,"lbl","w150",2,"text-align","right"],["formControlName","visaSponsorName",1,"stdd","w200",3,"label"],["formControlName","visaNo",1,"stdd","w150",3,"label"],["type","text","placeholder","Date","formControlName","visaDateG","bsDatepicker","",1,"stdd","w100",3,"bsValue","bsConfig"],["type","text","placeholder","Date","formControlName","visaExpiryG","bsDatepicker","",1,"stdd","w100",3,"bsValue","bsConfig"],[1,"my-1"],[1,"lbl","w50"],[1,"lbl","w250"],[1,"lbl","w200"],[1,"lbl","w150"],["title","add a new Customer Official",1,"btn",3,"click"],["formArrayName","visaItems"],[4,"ngFor","ngForOf"],[1,"stdd",2,"margin-left","627px"],[1,"stdd","w50",2,"text-align","right"],[3,"formGroupName"],["formControlName","srNo",1,"stdd","w50",2,"text-align","center",3,"label"],["formControlName","visaCategoryEnglish",1,"stdd","w250",3,"label"],["formControlName","visaCategoryArabic",1,"stdd","100",3,"label"],["formControlName","visaConsulate",1,"stdd","150",3,"label"],["type","text","placeholder","Qnty","formControlName","visaQuantity",1,"stdd","w50",2,"text-align","right",3,"change"],["class","alert alert-danger",4,"ngIf"],[1,"btn","red",3,"click"],[1,"alert","alert-danger"]],template:function(i,n){1&i&&(t.DNE(0,pt,9,1,"div",0),t.DNE(1,gt,35,12,"div",1)),2&i&&(t.Y8G("ngIf",n.visa),t.R7$(1),t.Y8G("ngIf",n.visa))},dependencies:[m.Sq,m.bT,Y.pc,Y.p0,c.qT,c.me,c.BC,c.cb,c.j4,c.JD,c.$R,c.v8,S.vr,mt.f,p.Wk,C.An],styles:[".lbl[_ngcontent-%COMP%]{display:inline-block;font-size:small;font-weight:700;margin:0 2px}.lbl2[_ngcontent-%COMP%]{width:200px;display:inline-block;font-size:small;font-weight:700;margin:0 2px 0 10px;width:100px}.stdd[_ngcontent-%COMP%]{display:inline-block;font-size:small;font-weight:700;margin:0 2px}.w25[_ngcontent-%COMP%]{width:25px}.w50[_ngcontent-%COMP%]{width:50px}.w70[_ngcontent-%COMP%]{width:70px}.w100[_ngcontent-%COMP%]{width:100px}.w150[_ngcontent-%COMP%]{width:150px}.w200[_ngcontent-%COMP%]{width:200px}.w250[_ngcontent-%COMP%]{width:250px}.btn[_ngcontent-%COMP%]{color:#f0f8ff;margin:0 2px;width:20px;vertical-align:middle;display:inline-block}.red[_ngcontent-%COMP%]{color:red}"]})}return s})();var _t=o(8892);function bt(s,a){if(1&s&&(t.j41(0,"div")(1,"div",1),t.EFF(2),t.k0s(),t.j41(3,"div",2),t.EFF(4),t.k0s(),t.j41(5,"div",2),t.EFF(6),t.k0s(),t.j41(7,"div",3),t.EFF(8),t.k0s(),t.j41(9,"div",3),t.EFF(10),t.nI1(11,"date"),t.k0s(),t.j41(12,"div",2),t.EFF(13),t.k0s(),t.j41(14,"div",3),t.EFF(15),t.nI1(16,"date"),t.k0s(),t.j41(17,"div",3),t.EFF(18),t.nI1(19,"date"),t.k0s()()),2&s){const e=t.XpG();t.R7$(2),t.JRh(e.visa.applicationNo),t.R7$(2),t.JRh(e.visa.candidateName),t.R7$(2),t.JRh(e.visa.customerKnownAs),t.R7$(2),t.JRh(e.visa.visaNo),t.R7$(2),t.JRh(t.i5U(11,8,e.visa.visaDateG,"dd-MMM-yy")),t.R7$(3),t.JRh(e.visa.visaCategory),t.R7$(2),t.JRh(t.i5U(16,11,e.visa.visaAppSubmitted,"dd-MMM-yy")),t.R7$(3),t.JRh(t.i5U(19,14,e.visa.visaApproved,"dd-MMM-yy"))}}let Ft=(()=>{class s{constructor(e){this.service=e,this.isReport=!1}ngOnInit(){}static#t=this.\u0275fac=function(i){return new(i||s)(t.rXU(v))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["app-visa-transaction-line"]],inputs:{visa:"visa",isReport:"isReport"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"stdd","w40",2,"margin-left","15px"],[1,"stdd","w125"],[1,"stdd","w80"]],template:function(i,n){1&i&&t.DNE(0,bt,20,17,"div",0),2&i&&t.Y8G("ngIf",n.visa)},dependencies:[m.bT,m.vh],styles:[".stdd[_ngcontent-%COMP%]{display:inline-block;word-wrap:break-word;font-size:smaller;margin:0 2px 0 8px;vertical-align:top}.w40[_ngcontent-%COMP%]{width:40px}.w80[_ngcontent-%COMP%]{width:80px}.w100[_ngcontent-%COMP%]{width:100px}.w125[_ngcontent-%COMP%]{width:125px}"]})}return s})();function xt(s,a){if(1&s){const e=t.RV6();t.j41(0,"pagination",13),t.bIt("pageChanged",function(n){t.eBV(e);const r=t.XpG();return t.Njj(r.onPageChanged(n))}),t.EFF(1," >"),t.k0s()}if(2&s){const e=t.XpG();t.Y8G("totalItems",e.pagination.totalItems)("itemsPerPage",e.pagination.itemsPerPage)("maxSize",15)}}function Et(s,a){1&s&&(t.j41(0,"div",14),t.EFF(1," No Visas on record matching your criteria "),t.k0s())}function Vt(s,a){if(1&s&&(t.j41(0,"div"),t.nrm(1,"app-visa-transaction-line",16),t.k0s()),2&s){const e=a.$implicit;t.R7$(1),t.Y8G("visa",e)}}function It(s,a){if(1&s&&(t.j41(0,"div",10),t.DNE(1,Vt,2,1,"div",15),t.k0s()),2&s){const e=t.XpG();t.R7$(1),t.Y8G("ngForOf",e.visas)}}let O=(()=>{class s{constructor(e,i,n){this.service=e,this.toastr=i,this.activatedRoute=n,this.visas=[],this.totalCount=0,this.totalBal=0,this.vParams=new l,this.printVisas=[],this.isPrintPDF=!1}ngOnInit(){this.activatedRoute.data.subscribe(e=>{this.visas=e.visas.result,this.pagination=e.visas.pagination,this.totalCount=e.visas.totalCount}),this.visas&&(this.totalBal=+this.visas.map(e=>e.visaBalance).reduce((e,i)=>+e+ +i,0))}loadVisas(){var e=this.service.getParams();this.service.getPagedVisaTransactions(e)?.subscribe({next:i=>{null!=i?(this.visas=i.result,this.totalCount=i?.count,this.pagination=i.pagination):console.log("response is undefined")},error:i=>console.log(i.error?.details,"Error encountered")})}onPageChanged(e){const i=this.service.getParams();i.pageNumber!==e&&(i.pageNumber=e.page,this.service.setParams(i),this.loadVisas())}generatePDF(){this.printVisas=this.visas,this.printVisas.length&&(this.isPrintPDF=!0)}static#t=this.\u0275fac=function(i){return new(i||s)(t.rXU(v),t.rXU(u.tw),t.rXU(p.nX))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["app-visa-transactions"]],decls:32,vars:5,consts:[["id","print-section"],[2,"display","inline-block","font-weight","bold"],[2,"display","inline-block","margin-left","15px","vertical-align","top"],["class","mx-1","style","display: inline-block;","previousText","\u2039","nextText","\u203a","firstText","\xab","lastText","\xbb",3,"totalItems","itemsPerPage","maxSize","pageChanged",4,"ngIf"],["printSectionId","print-section","printTitle","printTitle","ngxPrint","","title","shows the report in pdf format and enables printing","title","print pdf for current category Ref",2,"display","inline-block","margin-left","50px",3,"previewOnly","useExistingCss","click"],["title","Exit this page","routerLink","/visas",1,"btn"],[1,"form-inline"],[1,"lbl","w40",2,"margin-left","15px"],[1,"lbl","w125"],[1,"lbl","w80"],[1,"my-0"],["class","my-2 red ml25",4,"ngIf"],["class","my-0",4,"ngIf"],["previousText","\u2039","nextText","\u203a","firstText","\xab","lastText","\xbb",1,"mx-1",2,"display","inline-block",3,"totalItems","itemsPerPage","maxSize","pageChanged"],[1,"my-2","red","ml25"],[4,"ngFor","ngForOf"],[3,"visa"]],template:function(i,n){1&i&&(t.j41(0,"div",0)(1,"h4",1),t.EFF(2,"Visa Transaction Listing"),t.k0s(),t.j41(3,"div",2),t.DNE(4,xt,2,3,"pagination",3),t.j41(5,"button",4),t.bIt("click",function(){return n.generatePDF()}),t.j41(6,"mat-icon"),t.EFF(7,"print"),t.k0s()(),t.j41(8,"button",5)(9,"mat-icon"),t.EFF(10,"cancel"),t.k0s()()(),t.nrm(11,"br"),t.j41(12,"div",6)(13,"label",7),t.EFF(14,"App No"),t.k0s(),t.j41(15,"label",8),t.EFF(16,"Candidate Name"),t.k0s(),t.j41(17,"label",8),t.EFF(18,"Customer"),t.k0s(),t.j41(19,"label",9),t.EFF(20,"Visa No"),t.k0s(),t.j41(21,"label",9),t.EFF(22,"Visa Date"),t.k0s(),t.j41(23,"label",8),t.EFF(24,"Visa Category"),t.k0s(),t.j41(25,"label",9),t.EFF(26,"Visa Docs"),t.nrm(27,"br"),t.EFF(28,"submitted On"),t.k0s()(),t.nrm(29,"hr",10),t.DNE(30,Et,2,0,"div",11),t.DNE(31,It,2,1,"div",12),t.k0s()),2&i&&(t.R7$(4),t.Y8G("ngIf",void 0!==n.pagination),t.R7$(1),t.Y8G("previewOnly",!1)("useExistingCss",!0),t.R7$(25),t.Y8G("ngIf",!n.visas),t.R7$(1),t.Y8G("ngIf",n.visas))},dependencies:[m.Sq,m.bT,B.eK,F.GV,p.Wk,C.An,Ft],styles:[".lbl[_ngcontent-%COMP%]{display:inline-block;word-wrap:break-word;font-size:smaller;margin:0 2px 0 8px;vertical-align:middle}.w40[_ngcontent-%COMP%]{width:40px}.w80[_ngcontent-%COMP%]{width:80px}.w100[_ngcontent-%COMP%]{width:100px}.w125[_ngcontent-%COMP%]{width:125px}.red[_ngcontent-%COMP%]{color:red}.ml25[_ngcontent-%COMP%]{margin-left:25px}.btn[_ngcontent-%COMP%]{color:#f0f8ff;margin:0 2px;width:20px;vertical-align:top;display:inline-block}"]})}return s})();const Q=s=>{var a=new l,e=s.paramMap.get("visaId");return null!==e&&""!==e&&"0"!==e&&(a.id=+e),(0,t.WQX)(v).getPagedVisaTransactions(a)},wt=[{path:"",component:ct,resolve:{visas:s=>{var a=new l,e=s.paramMap.get("id");return null!==e&&""!==e&&"0"!==e&&(a.id=+e),(0,t.WQX)(v).getPagedVisasBrief(a)}}},{path:"visaEdit/:visaid",component:ft,resolve:{customers:s=>{var a=s.paramMap.get("custType");return null===a?(0,j.of)(null):("associate"===a||"vendor"===a||(a="Customer"),console.log("custType",a),(0,t.WQX)(_t.h).getCustomerList(a))}}},{path:"visaTransactions",component:O,resolve:{visas:Q}},{path:"visaTransactions/:visaId",component:O,resolve:{visas:Q}},{path:"visaTransactionByCVRefId/:cvRefId",component:O,resolve:{visas:s=>{var a=new l,e=s.paramMap.get("cvRefId");return null!==e&&""!==e&&"0"!==e&&(a.cvRefId=+e),(0,t.WQX)(v).getPagedVisaTransactions(a)}}}];let yt=(()=>{class s{static#t=this.\u0275fac=function(i){return new(i||s)};static#e=this.\u0275mod=t.$C({type:s});static#i=this.\u0275inj=t.G2t({imports:[m.MD,p.iI.forChild(wt),p.iI]})}return s})(),kt=(()=>{class s{static#t=this.\u0275fac=function(i){return new(i||s)};static#e=this.\u0275mod=t.$C({type:s});static#i=this.\u0275inj=t.G2t({imports:[m.MD,b.G,F.jN,yt,C.m_]})}return s})()}}]);