"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[265],{6579:(x,b,r)=>{r.d(b,{M:()=>k});class k{constructor(){this.customerId=0,this.email="",this.phoneNo="",this.dateIssued=new Date,this.dateReceived=new Date,this.pageNumber=1,this.pageSize=10,this.search="",this.sort=""}}},8228:(x,b,r)=>{r.d(b,{n:()=>p});var k=r(2771),u=r(7673),o=r(6354),e=r(3587),v=r(6579),f=r(6220),_=r(7705),E=r(1626);let p=(()=>{class l{constructor(s){this.http=s,this.apiUrl=e.c.apiUrl,this.currentUserSource=new k.m(1),this.currentUser$=this.currentUserSource.asObservable(),this.fParams=new v.M,this.cache=new Map}getFeedbacks(s){const c=this.cache.get(Object.values(s).join("-"));if(c)return(0,u.of)(c);let C=(0,f.H2)(s);return(0,f.f8)(this.apiUrl+"Feedback/pagedlist",C,this.http).pipe((0,o.T)(g=>(this.cache.set(Object.values(s).join("-"),g),g)))}getFeedbackWithItems(s){return this.http.get(this.apiUrl+"Feedback/FeedbackFromId/"+s)}updateFeedback(s){return console.log("updatefeedback service:",s),this.http.put(this.apiUrl+"Feedback",s)}deleteFeedback(s){return this.http.delete(this.apiUrl+"Feedback/delete/"+s)}saveNewFeedback(s){return this.http.post(this.apiUrl+"Feedback/saveFeedback",s)}deleteFeedbackInput(s){return this.http.delete(this.apiUrl+"Feedback/deleteinput/"+s)}getFeedbackObject(s,c){return this.http.get(this.apiUrl+"Feedback/newfeedback/"+s+"/"+c)}getFeedbackHistory(s){return this.http.get(this.apiUrl+"Feedback/history/"+s)}sendFeedbackMail(s){return this.http.get(this.apiUrl+"Feedback/sendfeedback/"+s)}setParams(s){this.fParams=s}getParams(){return this.fParams}static#e=this.\u0275fac=function(c){return new(c||l)(_.KVO(E.Qq))};static#t=this.\u0275prov=_.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})()},3265:(x,b,r)=>{r.d(b,{J:()=>y});var k=r(5964),u=r(5558),o=r(6579),e=r(7705),v=r(5743),f=r(8228),_=r(778),E=r(8256),p=r(177),l=r(3400),j=r(9213);function s(a,m){if(1&a){const t=e.RV6();e.j41(0,"div")(1,"div",1),e.EFF(2),e.k0s(),e.j41(3,"div",2),e.EFF(4),e.k0s(),e.j41(5,"div",3),e.EFF(6),e.k0s(),e.j41(7,"div",4),e.EFF(8),e.nI1(9,"date"),e.k0s(),e.j41(10,"div",4),e.EFF(11),e.nI1(12,"date"),e.k0s(),e.j41(13,"div",2),e.EFF(14),e.k0s(),e.j41(15,"button",5),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.editClicked(i.fdbk.id))}),e.j41(16,"mat-icon"),e.EFF(17,"edit"),e.k0s()(),e.j41(18,"button",6),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.generateEmail(i.fdbk.id))}),e.j41(19,"mat-icon"),e.EFF(20,"mail"),e.k0s()(),e.j41(21,"button",7),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.deleteClicked(i.fdbk.id))}),e.j41(22,"mat-icon"),e.EFF(23,"delete"),e.k0s()()()}if(2&a){const t=e.XpG();e.R7$(2),e.JRh(t.fdbk.customerName),e.R7$(2),e.JRh(t.fdbk.city),e.R7$(2),e.JRh(t.fdbk.officialName),e.R7$(2),e.JRh(e.i5U(9,6,t.fdbk.dateIssued,"dd-MMM-yy")),e.R7$(3),e.JRh(e.i5U(12,9,t.fdbk.dateReceived,"dd-MMM-yy")),e.R7$(3),e.JRh(t.fdbk.gradeAssessedByClient)}}let c=(()=>{class a{constructor(t){this.service=t,this.editEvent=new e.bkB,this.deleteEvent=new e.bkB,this.emailEvent=new e.bkB}editClicked(t){this.service.getFeedbackWithItems(t).subscribe({next:n=>{this.editEvent.emit(t)}})}deleteClicked(t){this.deleteEvent.emit(t)}generateEmail(t){this.emailEvent.emit(t)}static#e=this.\u0275fac=function(n){return new(n||a)(e.rXU(f.n))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["app-feedback-line"]],inputs:{fdbk:"fdbk"},outputs:{editEvent:"editEvent",deleteEvent:"deleteEvent",emailEvent:"emailEvent"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"stdd","w200"],[1,"stdd","w75"],[1,"stdd","w125"],[1,"stdd","w100"],["title","Edit this Feedback.  It is not editable if the Feedback has already been forwarded to client",1,"btn",3,"click"],["title","send to the client a link to this feedback",1,"btn",3,"click"],["title","delete this feedback.  It cannot be deleted if it is already sent to the client",1,"btn","red",3,"click"]],template:function(n,i){1&n&&e.DNE(0,s,24,12,"div",0),2&n&&e.Y8G("ngIf",i.fdbk)},dependencies:[p.bT,j.An,p.vh],styles:[".w50[_ngcontent-%COMP%]{width:50px}.w75[_ngcontent-%COMP%]{width:75px}.w100[_ngcontent-%COMP%]{width:100px}.w125[_ngcontent-%COMP%]{width:125px}.w150[_ngcontent-%COMP%]{width:150px}.w200[_ngcontent-%COMP%]{width:200px}.stdd[_ngcontent-%COMP%]{display:inline-block;font-size:smaller;margin:0 2px}.btn[_ngcontent-%COMP%]{color:#f0f8ff;font-size:smaller;margin:0 2px}.red[_ngcontent-%COMP%]{color:red}"]})}return a})();const C=["search"];function g(a,m){if(1&a){const t=e.RV6();e.j41(0,"div",8)(1,"pagination",9),e.bIt("pageChanged",function(i){e.eBV(t);const d=e.XpG();return e.Njj(d.onPageChanged(i))}),e.EFF(2," >"),e.k0s(),e.j41(3,"label",10),e.EFF(4),e.k0s()()}if(2&a){const t=e.XpG();e.R7$(1),e.Y8G("totalItems",t.pagination.totalItems)("itemsPerPage",t.pagination.itemsPerPage)("maxSize",15),e.R7$(3),e.SpI(" of ",t.pagination.totalItems,"")}}function w(a,m){if(1&a){const t=e.RV6();e.j41(0,"div",8)(1,"input",11,12),e.bIt("keyup.enter",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.onSearch())}),e.k0s(),e.j41(3,"button",13),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.onSearch())}),e.j41(4,"mat-icon"),e.EFF(5,"search"),e.k0s()(),e.j41(6,"button",14),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.onReset())}),e.j41(7,"mat-icon"),e.EFF(8,"refresh"),e.k0s()(),e.j41(9,"button",15)(10,"mat-icon"),e.EFF(11,"cancel"),e.k0s()(),e.j41(12,"h6",16),e.EFF(13,'To add a new feedback, go to the customers listing, " + "click a button to the right against a customer name in Customer Index'),e.k0s()()}}function M(a,m){1&a&&(e.j41(0,"div"),e.EFF(1," No feedback data available as per your search conditions\n"),e.k0s())}function I(a,m){if(1&a){const t=e.RV6();e.j41(0,"div")(1,"app-feedback-line",18),e.bIt("editEvent",function(i){e.eBV(t);const d=e.XpG(2);return e.Njj(d.editClicked(i))})("deleteEvent",function(i){e.eBV(t);const d=e.XpG(2);return e.Njj(d.deleteClicked(i))})("emailEvent",function(i){e.eBV(t);const d=e.XpG(2);return e.Njj(d.emailClicked(i))}),e.k0s()()}if(2&a){const t=m.$implicit;e.R7$(1),e.Y8G("fdbk",t)}}function O(a,m){if(1&a&&(e.j41(0,"div"),e.DNE(1,I,2,1,"div",17),e.k0s()),2&a){const t=e.XpG();e.R7$(1),e.Y8G("ngForOf",t.feedbacks)}}let y=(()=>{class a{constructor(t,n,i,d){this.router=t,this.service=n,this.confirm=i,this.toastr=d,this.feedbacks=[],this.fParams=new o.M,this.totalCount=0,this.returnUrl="";let h=this.router.getCurrentNavigation();h?.extras&&h.extras.state&&(h.extras.state.returnUrl&&(this.returnUrl=h.extras.state.returnUrl),h.extras.state.user&&(this.user=h.extras.state.user))}ngOnInit(){this.loadFeedbacks()}loadFeedbacks(){this.service.setParams(this.fParams??new o.M),this.service.getFeedbacks(this.fParams).subscribe({next:t=>{t.result&&t.pagination&&(this.feedbacks=t.result,this.totalCount=t.count,this.pagination=t.pagination)}})}navigateByUrl(t){this.router.navigate([t],{state:{user:this.user,returnUrl:"/feedback/list"}})}onSearch(){const t=this.service.getParams()??new o.M;t.search=this.searchTerm.nativeElement.value,t.pageNumber=1,this.service.setParams(t),this.loadFeedbacks()}onReset(){this.searchTerm.nativeElement.value="",this.fParams=new o.M,this.service.setParams(this.fParams),this.loadFeedbacks()}onPageChanged(t){const n=this.service.getParams()??new o.M;n.pageNumber!==t.page&&(n.pageNumber=t.page,this.service.setParams(n),this.loadFeedbacks())}editClicked(t){this.navigateByUrl("/feedback/edit/"+t+"/0")}deleteClicked(t){var n=t;const d=this.service.deleteFeedback(n);this.confirm.confirm("confirm Delete","confirm delete this Feedback record?. WARNING: this cannot be undone").pipe((0,k.p)(F=>F),(0,u.n)(F=>d)).subscribe(F=>{if(F){this.toastr.success("Customer deleted","deletion successful");var P=this.feedbacks.findIndex(R=>R.id==n);P>=0&&this.feedbacks.splice(P,1)}else this.toastr.error("Error in deleting the Feedback","failed to delete")})}emailClicked(t){var n=t;isNaN(n)&&this.toastr.warning("event.id is NaN"),this.service.sendFeedbackMail(+n).subscribe({next:i=>{console.log("response:",i),""===i?this.toastr.success("the message was generated - it is available in the messages draft folder for you to edit and send"):this.toastr.warning(i,"Failed to generate the message")},error:i=>{console.log("error:",i),this.toastr.error(i.error.details,"Error")}})}static#e=this.\u0275fac=function(n){return new(n||a)(e.rXU(v.Ix),e.rXU(f.n),e.rXU(_.G),e.rXU(E.tw))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["app-feedback-list"]],viewQuery:function(n,i){if(1&n&&e.GBs(C,5),2&n){let d;e.mGM(d=e.lsd())&&(i.searchTerm=d.first)}},decls:20,vars:4,consts:[[2,"display","inline-block","font-size","larger","font-weight","bold"],["class","stdd",4,"ngIf"],[1,"my-0"],[1,"stdd","w200"],[1,"stdd","w75"],[1,"stdd","w125"],[1,"stdd","w100"],[4,"ngIf"],[1,"stdd"],["previousText","\u2039","nextText","\u203a","firstText","\xab","lastText","\xbb",1,"my-2",2,"display","inline-block","vertical-align","top",3,"totalItems","itemsPerPage","maxSize","pageChanged"],[2,"width","50px","display","inline-block","padding-left","5px","font-size","large","word-wrap","break-word","vertical-align","middle"],["type","text","title","enter text to search","placeholder","Search",1,"stdd","form-control","w300",2,"margin-left","20px",3,"keyup.enter"],["search",""],["type","button",1,"btn",3,"click"],["type","button",1,"btn","mx-3",3,"click"],["type","button","routerLink","/",1,"btn","red","mx-3"],[1,"stdd","w300"],[4,"ngFor","ngForOf"],[3,"fdbk","editEvent","deleteEvent","emailEvent"]],template:function(n,i){1&n&&(e.j41(0,"div",0),e.EFF(1,"Customer Feedback Listing"),e.k0s(),e.DNE(2,g,5,4,"div",1),e.DNE(3,w,14,0,"div",1),e.nrm(4,"hr",2),e.j41(5,"div",3),e.EFF(6,"Customer"),e.k0s(),e.j41(7,"div",4),e.EFF(8,"City"),e.k0s(),e.j41(9,"div",5),e.EFF(10,"Official Name"),e.k0s(),e.j41(11,"div",6),e.EFF(12,"Issued On"),e.k0s(),e.j41(13,"div",6),e.EFF(14,"Received On"),e.k0s(),e.j41(15,"div",4),e.EFF(16,"Grade"),e.k0s(),e.nrm(17,"hr",2),e.DNE(18,M,2,0,"div",7),e.DNE(19,O,2,1,"div",7)),2&n&&(e.R7$(2),e.Y8G("ngIf",void 0!==i.pagination),e.R7$(1),e.Y8G("ngIf",i.feedbacks),e.R7$(15),e.Y8G("ngIf",!i.feedbacks),e.R7$(1),e.Y8G("ngIf",i.feedbacks))},dependencies:[p.Sq,p.bT,l.eK,v.Wk,j.An,c],styles:[".stdd[_ngcontent-%COMP%]{display:inline-block;font-size:small;margin:0 2px;vertical-align:top;word-wrap:normal}.btn[_ngcontent-%COMP%]{color:#f0f8ff;margin:0 2px;width:20px;vertical-align:middle}.w50[_ngcontent-%COMP%]{width:50px}.w75[_ngcontent-%COMP%]{width:75px}.w100[_ngcontent-%COMP%]{width:100px}.w125[_ngcontent-%COMP%]{width:125px}.w150[_ngcontent-%COMP%]{width:150px}.w200[_ngcontent-%COMP%]{width:200px}.w300[_ngcontent-%COMP%]{width:300px}"]})}return a})()}}]);